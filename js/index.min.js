let status="JS - OK!";function cl(e,t,o,n){return console.log(e,t||"",o||"",n||""),"-"}var glob={navMenuWrapper:null,navMenu:null,pageOverlay:null,scrollTopButton:null};$(".click-for-video").click(function(){this.style.display="none",$("div.youtube").css("display","block"),$("div.youtube").css("display","block"),$("iframe.youtube").prop("src","https://www.youtube.com/embed/dQw4w9WgXcQ?;autoplay=1&;controls=0&;showinfo=0")});var globFunc={returnDOM:function(e){return e instanceof jQuery?e[0]:e},showOverlay:function(e,t,o){switch(e){case"popup":t.classList.contains("js_openPopup")||(t.style.zIndex=1150,t.style.visibility="visible",t.classList.add("js_openPopup"),t.classList.add("js_open"),o&&t.classList.add(o),document.body.classList.add("js_pageOverlayOpen"));break;case"menu":t.classList.contains("js_openMenu")||(t.style.zIndex=900,t.style.visibility="visible",t.classList.add("js_openMenu"),t.classList.add("js_open"),document.body.classList.add("js_pageOverlayOpen"))}},hideOverlay:function(e,t,o){switch(e){case"popup":t.classList.contains("js_openPopup")&&(t.classList.remove("js_openPopup"),t.classList.remove("js_open"),o&&t.classList.remove(o),document.body.classList.remove("js_pageOverlayOpen"),setTimeout(function(){t.classList.contains("js_openPopup")||(t.style.zIndex=-10,t.style.visibility="hidden")},300));break;case"menu":t.classList.contains("js_openMenu")&&(t.classList.remove("js_openMenu"),t.classList.remove("js_open"),document.body.classList.remove("js_pageOverlayOpen"),setTimeout(function(){t.classList.contains("js_openMenu")||(t.style.zIndex=-10,t.style.visibility="hidden")},300))}},toggleButtonContent:function(e,t){var o,n=this.returnDOM(e);t?o=t:e.dataset.text&&(o={default:e.dataset.text,active:e.dataset.textActive}),n.classList.contains("active")?(o&&(n.querySelector("span").innerHTML=o.default),n.classList.remove("active")):(o&&(n.querySelector("span").innerHTML=o.active),n.classList.add("active"))},dropDown:(e,t)=>{e.checked||e.classList.contains("active")?t.style.height=t.firstElementChild.offsetHeight+"px":t.style.height="0px"},animateBlock:function(e){let t=this;this.removeClassFrom(e,"js_animate"),setTimeout(function(){t.addClassTo(e,"js_animate")},50)},getCurrentYPosition:function(){return window.pageYOffset||document.documentElement.scrollTop},addClassTo:function(e,t){var o=this.returnDOM(e);o.classList.contains(t)||o.classList.add(t)},removeClassFrom:function(e,t){var o=this.returnDOM(e);o.classList.contains(t)&&o.classList.remove(t)},transitionHandler:function(e,t,o){e.propertyName&&console.log(e.propertyName),e.srcElement&&console.log(e.srcElement)},getChildsTotalWidth:function(e){let t=e.children,o=0;for(let e=0;e<t.length;e++)o+=t[e].offsetWidth;return o},getCoordsOnPage:function(e){var t=this.returnDOM(e).getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset,bottom:t.bottom+pageYOffset}},getCoordsOnScreen:function(e){var t=this.returnDOM(e).getBoundingClientRect();return{top:t.top,left:t.left,bottom:t.bottom,right:t.right,width:t.width,height:t.height}},openWidth:function(e){e.style.width=getChildsTotalWidth(e)+"px"},collapseWidth:function(e){e.style.width="0"},isVisible:function(e,t){let o;o=t||"whole";var n=window.pageYOffset,s=document.documentElement.clientHeight,i=e.getBoundingClientRect().top+pageYOffset,l=i+e.offsetHeight;return"whole"==o?document.documentElement.clientWidth>991?l<=n+s&&i>=n:i<=n+s/2&&i>=n:"topBorder"==o?i>=n+130&&i<=n+s:"topBorderIn"==o?i<=n+s:void 0},isVisibleOnXAxis:function(e,t){let o=e.getBoundingClientRect().left>t.getBoundingClientRect().left,n=e.getBoundingClientRect().right<t.getBoundingClientRect().right;return o&&n},isLastChild:function(e){return!e.nextElementSibling},isFirstChild:function(e){return!e.previousElementSibling}},test="include js error";$(document).ready(function(){console.log("document ready"),test="include js - OK",glob.navMenuWrapper=document.getElementById("navMenuWrapper"),glob.navMenu=document.getElementById("navMenu"),glob.pageOverlay=document.getElementById("pageOverlay"),$("body")||console.log("jQuery Error"),$(".dropdownButton").on("click",function(){globFunc.toggleButtonContent(this),globFunc.dropDown(this,glob.navMenuWrapper)}),$("body").on("click",".searchButton",function(){let e=$("#popupSearch");e.length&&glob.PopupModule.openPopup(e,"js_openPopup_search")}),$("body").on("click",".button",function(){let e=document.getElementById("id");e&&glob.PopupModule.openPopup(e)}),$(".description .ellipsis").dotdotdot({height:80,truncate:"word",watch:!0}),$(".title.ellipsis").dotdotdot({height:85,truncate:"word",watch:!0});var e=document.querySelectorAll(".description > p");if(e.length)for(var t=0;t<e.length;t++)!e[t].innerHTML&&e[t].parentElement.removeChild(e[t]);(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<450&&($(".slideItem").slick({slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!0,asNavFor:".slideItemVertical"}),$(".slideItemVertical").slick({slidesToShow:1,slidesToScroll:1,asNavFor:".slideItem",dots:!0,centerMode:!0,focusOnSelect:!0,vertical:!0})),(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)>550&&($(".slideItem").slick({slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!0,asNavFor:".slideItemVertical"}),$(".slideItemVertical").slick({slidesToShow:3,slidesToScroll:1,asNavFor:".slideItem",dots:!0,centerMode:!0,focusOnSelect:!0,vertical:!0})),(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<550&&($(".slideItem").slick({slidesToShow:1,slidesToScroll:1,arrows:!1,fade:!0,asNavFor:".slideItemVertical"}),$(".slideItemVertical").slick({slidesToShow:2,slidesToScroll:1,asNavFor:".slideItem",dots:!0,centerMode:!0,focusOnSelect:!0,vertical:!0})),(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<768&&($(".slideshow").slick({dots:!0,infinite:!0,speed:500,fade:!0,cssEase:"linear"}),$(".slide").slick({dots:!0,infinite:!1,speed:500,slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3,infinite:!0,dots:!0}},{breakpoint:600,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]}))});var containerEl=document.querySelector(".container"),mixer=mixitup(containerEl);window.onload=function(){console.log("window load")};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInN0YXR1cyIsImNsIiwiYXJnMSIsImFyZzIiLCJhcmczIiwiYXJnNCIsImNvbnNvbGUiLCJsb2ciLCJnbG9iIiwibmF2TWVudVdyYXBwZXIiLCJuYXZNZW51IiwicGFnZU92ZXJsYXkiLCJzY3JvbGxUb3BCdXR0b24iLCIkIiwiY2xpY2siLCJzdHlsZSIsImRpc3BsYXkiLCJjc3MiLCJwcm9wIiwiZ2xvYkZ1bmMiLCJyZXR1cm5ET00iLCJlbGVtZW50Iiwic2hvd092ZXJsYXkiLCJvdmVybGF5VHlwZSIsIm92ZXJsYXlFbGVtZW50IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJhZGRpdGlvbmFsQ2xhc3MiLCJhZGQiLCJ2aXNpYmlsaXR5IiwiZG9jdW1lbnQiLCJib2R5IiwiaGlkZU92ZXJsYXkiLCJyZW1vdmUiLCJzZXRUaW1lb3V0IiwiekluZGV4IiwidG9nZ2xlQnV0dG9uQ29udGVudCIsImJ1dHRvbkVsZW1lbnQiLCJzdHJPYmoiLCJ0ZXh0IiwiYnV0dG9uIiwidGhpcyIsImRhdGFzZXQiLCJkZWZhdWx0IiwiYWN0aXZlIiwidGV4dEFjdGl2ZSIsImlubmVySFRNTCIsInF1ZXJ5U2VsZWN0b3IiLCJkcm9wRG93biIsInRhcmdldEJsb2NrIiwiY2hlY2tlZCIsImFuaW1hdGVCbG9jayIsImhlaWdodCIsImZpcnN0RWxlbWVudENoaWxkIiwib2Zmc2V0SGVpZ2h0Iiwic2VsZiIsImFkZENsYXNzVG8iLCJibG9jayIsInJlbW92ZUNsYXNzRnJvbSIsImdldEN1cnJlbnRZUG9zaXRpb24iLCJ3aW5kb3ciLCJwYWdlWU9mZnNldCIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsImFjdGl2ZUNsYXNzIiwiZWxlbSIsInByb3BlcnR5TmFtZSIsImhpZGRlbkNvbnRlbnQiLCJldmVudCIsInNyY0VsZW1lbnQiLCJnZXRDaGlsZHNUb3RhbFdpZHRoIiwicGFyZW50IiwiY2hpbGRyZW4iLCJyZXN1bHQiLCJpIiwibGVuZ3RoIiwib2Zmc2V0V2lkdGgiLCJnZXRDb29yZHNPblBhZ2UiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJib3giLCJsZWZ0IiwiYm90dG9tIiwicGFnZVhPZmZzZXQiLCJnZXRDb29yZHNPblNjcmVlbiIsInJpZ2h0Iiwid2lkdGgiLCJvcGVuV2lkdGgiLCJjb2xsYXBzZVdpZHRoIiwiaXNWaXNpYmxlIiwib3B0aW9uIiwid2luZG93VG9wIiwid2luZG93SGVpZ2h0IiwiZWxlbVBhZ2VUb3AiLCJlbGVtUGFnZUJvdHRvbSIsInRvcCIsIm9wdCIsImNsaWVudFdpZHRoIiwiaXNWaXNpYmxlT25YQXhpcyIsImlzVmlzaWJsZU9uUmlnaHQiLCJpc1Zpc2libGVPbkxlZnQiLCJpc0xhc3RDaGlsZCIsImlzRmlyc3RDaGlsZCIsIm5leHRFbGVtZW50U2libGluZyIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJ0ZXN0IiwicmVhZHkiLCJnZXRFbGVtZW50QnlJZCIsIm9uIiwibW9kYWwiLCJQb3B1cE1vZHVsZSIsIm9wZW5Qb3B1cCIsImRvdGRvdGRvdCIsInRydW5jYXRlIiwid2F0Y2giLCJ0ZXh0QmxvY2tzIiwicXVlcnlTZWxlY3RvckFsbCIsInBhcmVudEVsZW1lbnQiLCJyZW1vdmVDaGlsZCIsImlubmVyV2lkdGgiLCJzbGljayIsInNsaWRlc1RvU2hvdyIsInNsaWRlc1RvU2Nyb2xsIiwiYXJyb3dzIiwiZmFkZSIsImFzTmF2Rm9yIiwiZG90cyIsImNlbnRlck1vZGUiLCJmb2N1c09uU2VsZWN0IiwidmVydGljYWwiLCJpbmZpbml0ZSIsInNwZWVkIiwiY3NzRWFzZSIsInJlc3BvbnNpdmUiLCJicmVha3BvaW50Iiwic2V0dGluZ3MiLCJjb250YWluZXJFbCIsIm1peGVyIiwibWl4aXR1cCIsIm9ubG9hZCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsT0FBUyxXQUNiLFNBQVNDLEdBQUdDLEVBQU1DLEVBQU1DLEVBQU1DLEdBRTdCLE9BREFDLFFBQVFDLElBQUlMLEVBQU1DLEdBQVEsR0FBSUMs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QWdCLEVBQ2hCRyxTQUFVLGFBQ1ZDLE1BQU0sRUFDTkMsWUFBWSxFQUNaQyxlQUFlLEVBQ2ZDLFVBQVUsTUFJRHBFLE9BQU8wRCxZQUNaeEYsU0FBU2dDLGdCQUFnQmtDLGFBQ3pCbEUsU0FBU0MsS0FBS2lFLGFBQ1IsTUFDVm5GLEVBQUUsY0FBYzBHLE9BQ2ZDLGFBQWMsRUFDZEMsZUFBZ0IsRUFDaEJDLFFBQVEsRUFDUkMsTUFBTSxFQUNOQyxTQUFVLHVCQUVUL0csRUFBRSxzQkFBc0IwRyxPQUN6QkMsYUFBYyxFQUNkQyxlQUFnQixFQUNoQkcsU0FBVSxhQUNWQyxNQUFNLEVBQ05DLFlBQVksRUFDWkMsZUFBZSxFQUNmQyxVQUFVLE1BUUpwRSxPQUFPMEQsWUFDWnhGLFNBQVNnQyxnQkFBZ0JrQyxhQUN6QmxFLFNBQVNDLEtBQUtpRSxhQUNSLE1BQ1JuRixFQUFFLGNBQWMwRyxPQUNmTSxNQUFNLEVBQ05JLFVBQVUsRUFDVkMsTUFBTyxJQUNQUCxNQUFNLEVBQ05RLFFBQVMsV0FLVnRILEVBQUUsVUFBVTBHLE9BQ1hNLE1BQU0sRUFDTkksVUFBVSxFQUNWQyxNQUFPLElBQ1BWLGFBQWMsRUFDZEMsZUFBZ0IsRUFDaEJXLGFBRUNDLFdBQVksS0FDWkMsVUFDRWQsYUFBYyxFQUNkQyxlQUFnQixFQUNoQlEsVUFBVSxFQUNWSixNQUFNLEtBSVJRLFdBQVksSUFDWkMsVUFDRWQsYUFBYyxFQUNkQyxlQUFnQixLQUlsQlksV0FBWSxJQUNaQyxVQUNFZCxhQUFjLEVBQ2RDLGVBQWdCLFVBWXRCLElBQUljLFlBQWN6RyxTQUFTaUIsY0FBYyxjQUNyQ3lGLE1BQVFDLFFBQVFGLGFBRXBCM0UsT0FBTzhFLE9BQVMsV0FDZnBJLFFBQVFDLElBQUkiLCJmaWxlIjoiaW5kZXgubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHN0YXR1cyA9IFwiSlMgLSBPSyFcIjtcbmZ1bmN0aW9uIGNsKGFyZzEsIGFyZzIsIGFyZzMsIGFyZzQpIHtcblx0Y29uc29sZS5sb2coYXJnMSwgYXJnMiB8fCAnJywgYXJnMyB8fCAnJywgYXJnNCB8fCAnJyk7XG5cdHJldHVybiAnLSc7XG59XG5cbi8vIGNsKHN0YXR1cyk7XG5cblxudmFyIGdsb2IgPSB7XG5cdG5hdk1lbnVXcmFwcGVyOiBudWxsLFxuXHRuYXZNZW51OiBudWxsLFxuXHRwYWdlT3ZlcmxheTogbnVsbCxcblxuXHRzY3JvbGxUb3BCdXR0b246IG51bGwsXG59XG5cblxuJCgnLmNsaWNrLWZvci12aWRlbycpLmNsaWNrKGZ1bmN0aW9uKCkge1xuXHR0aGlzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdCQoJ2Rpdi55b3V0dWJlJykuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG5cdCQoJ2Rpdi55b3V0dWJlJykuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG5cdCQoJ2lmcmFtZS55b3V0dWJlJykucHJvcCgnc3JjJywgJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL2RRdzR3OVdnWGNRPzthdXRvcGxheT0xJjtjb250cm9scz0wJjtzaG93aW5mbz0wJyk7XG4gIH0pO1xuXG5cblxuLy8gPT09PT09PT09PT09PT09PT1cblxudmFyIGdsb2JGdW5jID0ge1xuICByZXR1cm5ET006IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudCBpbnN0YW5jZW9mIGpRdWVyeSA/IGVsZW1lbnRbMF0gOiBlbGVtZW50O1xuICB9LFxuXG4gIHNob3dPdmVybGF5OiBmdW5jdGlvbihvdmVybGF5VHlwZSwgb3ZlcmxheUVsZW1lbnQsIGFkZGl0aW9uYWxDbGFzcykge1xuICAgIHN3aXRjaCAob3ZlcmxheVR5cGUpIHtcbiAgICAgIGNhc2UgXCJwb3B1cFwiOlxuICAgICAgICBpZiAoIW92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanNfb3BlblBvcHVwJykpIHtcbiAgICAgICAgICBvdmVybGF5RWxlbWVudC5zdHlsZS56SW5kZXggPSAxMTUwO1xuICAgICAgICAgIG92ZXJsYXlFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG4gICAgICAgICAgb3ZlcmxheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnanNfb3BlblBvcHVwJyk7XG4gICAgICAgICAgb3ZlcmxheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnanNfb3BlbicpO1xuICAgICAgICAgIFxuICAgICAgICAgIGFkZGl0aW9uYWxDbGFzcyA/IG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoYWRkaXRpb25hbENsYXNzKSA6IG51bGw7XG5cbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoXCJqc19wYWdlT3ZlcmxheU9wZW5cIik7XG4gICAgICAgIH0gXG4gICAgICBicmVhaztcblxuICAgICAgY2FzZSBcIm1lbnVcIjpcbiAgICAgICAgaWYgKCFvdmVybGF5RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzX29wZW5NZW51JykpIHtcbiAgICAgICAgICBvdmVybGF5RWxlbWVudC5zdHlsZS56SW5kZXggPSA5MDA7XG4gICAgICAgICAgb3ZlcmxheUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcbiAgICAgICAgICBvdmVybGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdqc19vcGVuTWVudScpO1xuICAgICAgICAgIG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2pzX29wZW4nKTtcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoXCJqc19wYWdlT3ZlcmxheU9wZW5cIik7XG4gICAgICAgIH0gXG4gICAgICBicmVhaztcbiAgICB9XG4gIH0sXG4gIGhpZGVPdmVybGF5OiBmdW5jdGlvbihvdmVybGF5VHlwZSwgb3ZlcmxheUVsZW1lbnQsIGFkZGl0aW9uYWxDbGFzcykge1xuICAgIHN3aXRjaCAob3ZlcmxheVR5cGUpIHtcbiAgICAgIGNhc2UgXCJwb3B1cFwiOlxuICAgICAgICBpZiAob3ZlcmxheUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqc19vcGVuUG9wdXAnKSkge1xuICAgICAgICAgIG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX29wZW5Qb3B1cCcpO1xuICAgICAgICAgIG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX29wZW4nKTtcblxuICAgICAgICAgIGFkZGl0aW9uYWxDbGFzcyA/IG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoYWRkaXRpb25hbENsYXNzKSA6IG51bGw7XG5cbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJqc19wYWdlT3ZlcmxheU9wZW5cIik7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIW92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanNfb3BlblBvcHVwJykpIHtcbiAgICAgICAgICAgICAgb3ZlcmxheUVsZW1lbnQuc3R5bGUuekluZGV4ID0gLTEwO1xuICAgICAgICAgICAgICBvdmVybGF5RWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgMzAwKVxuICAgICAgICB9XG4gICAgICBicmVhaztcblxuICAgICAgY2FzZSBcIm1lbnVcIjpcbiAgICAgICAgaWYgKG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanNfb3Blbk1lbnUnKSkge1xuICAgICAgICAgIG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX29wZW5NZW51Jyk7XG4gICAgICAgICAgb3ZlcmxheUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnanNfb3BlbicpO1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShcImpzX3BhZ2VPdmVybGF5T3BlblwiKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghb3ZlcmxheUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqc19vcGVuTWVudScpKSB7XG4gICAgICAgICAgICAgIG92ZXJsYXlFbGVtZW50LnN0eWxlLnpJbmRleCA9IC0xMDtcbiAgICAgICAgICAgICAgb3ZlcmxheUVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIDMwMClcbiAgICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICB9LFxuXG4gIHRvZ2dsZUJ1dHRvbkNvbnRlbnQ6IGZ1bmN0aW9uIChidXR0b25FbGVtZW50LCBzdHJPYmopIHtcbiAgICB2YXIgYnV0dG9uID0gdGhpcy5yZXR1cm5ET00oYnV0dG9uRWxlbWVudCk7XG4gICAgdmFyIHRleHQ7XG5cbiAgICAvLyBjb25zb2xlLmxvZyhidXR0b25FbGVtZW50KVxuXG4gICAgaWYgKHN0ck9iaikgeyB0ZXh0ID0gc3RyT2JqIH0gZWxzZSBpZiAoYnV0dG9uRWxlbWVudC5kYXRhc2V0LnRleHQpIHtcbiAgICAgIHRleHQgPSB7XG4gICAgICAgIGRlZmF1bHQ6IGJ1dHRvbkVsZW1lbnQuZGF0YXNldC50ZXh0LFxuICAgICAgICBhY3RpdmU6IGJ1dHRvbkVsZW1lbnQuZGF0YXNldC50ZXh0QWN0aXZlXG4gICAgICB9XG4gICAgfVxuICAgIGxldCBidXR0b25BY3RpdmUgPSBidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKTtcblxuICAgIGlmIChidXR0b25BY3RpdmUpIHtcbiAgICAgIHRleHQgPyBidXR0b24ucXVlcnlTZWxlY3Rvcignc3BhbicpLmlubmVySFRNTCA9IHRleHQuZGVmYXVsdCA6IG51bGw7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgdGV4dCA/IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzcGFuJykuaW5uZXJIVE1MID0gdGV4dC5hY3RpdmUgOiBudWxsO1xuICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIH1cbiAgfSxcblxuICBkcm9wRG93bjogKGJ1dHRvbiwgdGFyZ2V0QmxvY2spID0+IHtcbiAgICBidXR0b24uY2hlY2tlZCB8fCBidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSA/IFxuICAgIHRhcmdldEJsb2NrLnN0eWxlLmhlaWdodCA9IHRhcmdldEJsb2NrLmZpcnN0RWxlbWVudENoaWxkLm9mZnNldEhlaWdodCArICdweCcgOlxuICAgIHRhcmdldEJsb2NrLnN0eWxlLmhlaWdodCA9IFwiMHB4XCI7ICAgIFxuICB9LFxuXG4gIGFuaW1hdGVCbG9jazogZnVuY3Rpb24gKGJsb2NrKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIHRoaXMucmVtb3ZlQ2xhc3NGcm9tKGJsb2NrLCAnanNfYW5pbWF0ZScpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7c2VsZi5hZGRDbGFzc1RvKGJsb2NrLCAnanNfYW5pbWF0ZScpIH0sIDUwKVxuICB9LFxuXG4gIGdldEN1cnJlbnRZUG9zaXRpb246IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgfSxcblxuICBhZGRDbGFzc1RvOiBmdW5jdGlvbihlbGVtZW50LCBhY3RpdmVDbGFzcykge1xuICAgIHZhciBlbGVtID0gdGhpcy5yZXR1cm5ET00oZWxlbWVudCk7XG4gICAgaWYgKCFlbGVtLmNsYXNzTGlzdC5jb250YWlucyhhY3RpdmVDbGFzcykpIHtcbiAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZChhY3RpdmVDbGFzcyk7XG4gICAgfVxuICB9LFxuICByZW1vdmVDbGFzc0Zyb206IGZ1bmN0aW9uKGVsZW1lbnQsIGFjdGl2ZUNsYXNzKSB7XG4gICAgdmFyIGVsZW0gPSB0aGlzLnJldHVybkRPTShlbGVtZW50KTtcbiAgICBpZiAoZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoYWN0aXZlQ2xhc3MpKSB7XG4gICAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoYWN0aXZlQ2xhc3MpO1xuICAgIH1cbiAgfSxcblxuICB0cmFuc2l0aW9uSGFuZGxlcjogZnVuY3Rpb24oZXZlbnQsIHRhcmdldEJsb2NrLCBoaWRkZW5Db250ZW50KSB7XG4gICAgaWYgKGV2ZW50LnByb3BlcnR5TmFtZSkge1xuICAgICAgY29uc29sZS5sb2coZXZlbnQucHJvcGVydHlOYW1lKSAgLy8geW91ciBjb2RlIGhlcmVcbiAgICB9XG5cbiAgICBpZiAoZXZlbnQuc3JjRWxlbWVudCkge1xuICAgICAgY29uc29sZS5sb2coZXZlbnQuc3JjRWxlbWVudCkgIC8vIHlvdXIgY29kZSBoZXJlXG4gICAgfVxuICB9LFxuXG4gIGdldENoaWxkc1RvdGFsV2lkdGg6IGZ1bmN0aW9uKHBhcmVudCkge1xuICAgIGxldCBjaGlsZHJlbiA9IHBhcmVudC5jaGlsZHJlbjtcbiAgICBsZXQgcmVzdWx0ID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlc3VsdCA9IHJlc3VsdCArIGNoaWxkcmVuW2ldLm9mZnNldFdpZHRoO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LFxuXG4gIGdldENvb3Jkc09uUGFnZTogZnVuY3Rpb24oZWxlbWVudCkgeyBcbiAgICB2YXIgZWxlbSA9IHRoaXMucmV0dXJuRE9NKGVsZW1lbnQpO1xuICAgIHZhciBib3ggPSBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcDogYm94LnRvcCArIHBhZ2VZT2Zmc2V0LFxuICAgICAgbGVmdDogYm94LmxlZnQgKyBwYWdlWE9mZnNldCxcbiAgICAgIGJvdHRvbTogYm94LmJvdHRvbSArIHBhZ2VZT2Zmc2V0XG4gICAgfTtcbiAgfSxcblxuICBnZXRDb29yZHNPblNjcmVlbjogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIHZhciBlbGVtID0gdGhpcy5yZXR1cm5ET00oZWxlbWVudCk7XG4gICAgdmFyIGJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiBib3gudG9wLFxuICAgICAgbGVmdDogYm94LmxlZnQsXG4gICAgICBib3R0b206IGJveC5ib3R0b20sXG4gICAgICByaWdodDogYm94LnJpZ2h0LFxuICAgICAgd2lkdGg6IGJveC53aWR0aCxcbiAgICAgIGhlaWdodDogYm94LmhlaWdodCxcbiAgICB9O1xuICB9LFxuXG4gIG9wZW5XaWR0aDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBnZXRDaGlsZHNUb3RhbFdpZHRoKGVsZW1lbnQpICsgJ3B4JztcbiAgfSxcbiAgY29sbGFwc2VXaWR0aDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSAnMCc7XG4gIH0sXG5cbiAgaXNWaXNpYmxlOiBmdW5jdGlvbihlbGVtLCBvcHRpb24pIHtcbiAgICAvLyB2YXIgZWxlbSA9IHRoaXMucmV0dXJuRE9NKGVsZW1lbnQpO1xuICAgIGxldCBvcHQ7XG4gICAgb3B0aW9uID8gb3B0ID0gb3B0aW9uIDogb3B0ID0gXCJ3aG9sZVwiO1xuICAgIHZhciB3aW5kb3dUb3AgPSB3aW5kb3cucGFnZVlPZmZzZXQ7XG4gICAgdmFyIHdpbmRvd0hlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgdmFyIGVsZW1QYWdlVG9wID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgKyBwYWdlWU9mZnNldDtcbiAgICB2YXIgZWxlbVBhZ2VCb3R0b20gPSBlbGVtUGFnZVRvcCArIGVsZW0ub2Zmc2V0SGVpZ2h0O1xuXG4gICAgaWYgKG9wdCA9PSBcIndob2xlXCIpIHtcbiAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPiA5OTEpIHtcbiAgICAgICAgcmV0dXJuIChlbGVtUGFnZUJvdHRvbSA8PSB3aW5kb3dUb3AgKyB3aW5kb3dIZWlnaHQpICYmIChlbGVtUGFnZVRvcCA+PSB3aW5kb3dUb3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICggZWxlbVBhZ2VUb3AgPD0gKHdpbmRvd1RvcCArIHdpbmRvd0hlaWdodCAvIDIpICkgJiYgKGVsZW1QYWdlVG9wID49IHdpbmRvd1RvcCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9wdCA9PSBcInRvcEJvcmRlclwiKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyh3aW5kb3dUb3ApXG4gICAgICByZXR1cm4gKGVsZW1QYWdlVG9wID49IHdpbmRvd1RvcCArIDEzMCkgJiYgKGVsZW1QYWdlVG9wIDw9IHdpbmRvd1RvcCArIHdpbmRvd0hlaWdodCk7XG4gICAgfVxuXG4gICAgaWYgKG9wdCA9PSBcInRvcEJvcmRlckluXCIpIHtcbiAgICAgIHJldHVybiBlbGVtUGFnZVRvcCA8PSB3aW5kb3dUb3AgKyB3aW5kb3dIZWlnaHQ7XG4gICAgfVxuXG4gICAgaWYgKG9wdCA9PSBcImJvdHRvbUJvcmRlclwiKSB7XG4gICAgICAvLyByZXR1cm4gZWxlbVBhZ2VUb3AgPj0gd2luZG93VG9wICsgMTA7XG4gICAgfVxuICB9LFxuXG4gIGlzVmlzaWJsZU9uWEF4aXM6IGZ1bmN0aW9uKGVsZW1lbnQsIHBhcmVudCkge1xuICAgIGxldCBpc1Zpc2libGVPbkxlZnQgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgPiBwYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcbiAgICBsZXQgaXNWaXNpYmxlT25SaWdodCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkucmlnaHQgPCBwYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkucmlnaHQ7XG4gICAgcmV0dXJuIGlzVmlzaWJsZU9uTGVmdCAmJiBpc1Zpc2libGVPblJpZ2h0O1xuICB9LFxuXG4gIGlzTGFzdENoaWxkOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubmV4dEVsZW1lbnRTaWJsaW5nID8gZmFsc2UgOiB0cnVlO1xuICB9LFxuICBpc0ZpcnN0Q2hpbGQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nID8gZmFsc2UgOiB0cnVlO1xuICB9LFxufVxuXG4vLyA9PT09PT09PT09PT09PT1cblxuXG52YXIgdGVzdCA9ICdpbmNsdWRlIGpzIGVycm9yJztcblxuLy8gaW1wb3J0IHsgZHJvcERvd24gfSBmcm9tICcuL2ZyYW1lcy9nbG9iYWxGdW5jdGlvbnMnXG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHRjb25zb2xlLmxvZygnZG9jdW1lbnQgcmVhZHknKVxuXHQvLyBjb25zb2xlLmxvZyhkcm9wRG93bilcdFxuXHQvLyA9PT09PT09PT09PT09PT09PUluY2x1ZGUgTW9kdWxlcz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdHRlc3QgPSAnaW5jbHVkZSBqcyAtIE9LJztcblxuXG4gIC8qLy8gY29uc29sZS5sb2coJ1BvcHVwTW9kdWxlIG9rJyk7XG4vLyA9PT09PT09PT09PT09PVBvcHVwIE9wZW4vQ2xvc2UgTW9kdWxlID09PT09PT09PT09PT09XG5nbG9iLlBvcHVwTW9kdWxlID0gKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGFkZGl0aW9uYWxDbGFzc1N0cjtcbiAgbGV0IG1vZGFscyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BvcHVwJyk7XG4gIGNvbnN0IHBhZ2VPdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VPdmVybGF5Jyk7XG5cblxuICBmdW5jdGlvbiB0b2dnbGVTaG93KGV2ZW50LCBwb3B1cEJsb2NrKSB7XG4gICAgdmFyIHBvcHVwID0gZ2xvYkZ1bmMucmV0dXJuRE9NKHBvcHVwQmxvY2spO1xuXG4gICAgaWYgKCBldmVudC5wcm9wZXJ0eU5hbWUgPT0gJ3RyYW5zZm9ybScgfHwgIGV2ZW50LnByb3BlcnR5TmFtZSA9PSAnb3BhY2l0eScpIHtcbiAgICAgIHBvcHVwLmNsYXNzTGlzdC5jb250YWlucygnanNfYW5pbWF0ZScpID8gbnVsbCA6IHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ2pzX29wZW4nKTtcbiAgICB9XG4gIH1cblxuICBpZiAobW9kYWxzLmxlbmd0aCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbW9kYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBtb2RhbHNbaV0uYWRkRXZlbnRMaXN0ZW5lcihcInRyYW5zaXRpb25lbmRcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHRvZ2dsZVNob3coZXZlbnQsIG1vZGFsc1tpXSlcbiAgICAgIH0sIGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvcGVuUG9wdXAocG9wdXBCbG9jaywgYWRkaXRpb25hbENsYXNzLCBvdmVybGF5QmxvY2spIHtcbiAgICBsZXQgb3ZlcmxheSA9IG92ZXJsYXlCbG9jayB8fCBwYWdlT3ZlcmxheTtcblxuICAgIHZhciBwb3B1cCA9IGdsb2JGdW5jLnJldHVybkRPTShwb3B1cEJsb2NrKTtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LmFkZChcImpzX29wZW5cIik7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJqc19hbmltYXRlXCIpO1xuXG4gICAgaWYgKGFkZGl0aW9uYWxDbGFzcykge1xuICAgICAgYWRkaXRpb25hbENsYXNzU3RyID0gYWRkaXRpb25hbENsYXNzO1xuICAgICAgZ2xvYkZ1bmMuc2hvd092ZXJsYXkoXCJwb3B1cFwiLCBvdmVybGF5LCBhZGRpdGlvbmFsQ2xhc3MpIFxuICAgIH0gZWxzZSB7XG4gICAgICBnbG9iRnVuYy5zaG93T3ZlcmxheShcInBvcHVwXCIsIG92ZXJsYXkpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlUG9wdXAocG9wdXBCbG9jaykge1xuICAgIC8vIGxldCBvdmVybGF5ID0gb3ZlcmxheUJsb2NrIHx8IHBhZ2VPdmVybGF5O1xuICAgIHZhciBwb3B1cCA9IGdsb2JGdW5jLnJldHVybkRPTShwb3B1cEJsb2NrKTtcbiAgICBcbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwianNfYW5pbWF0ZVwiKTtcbiAgICAvLyBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwianNfb3BlblwiKTtcbiAgICAvLyBhZGRpdGlvbmFsQ2xhc3MgPyBoaWRlT3ZlcmxheShcInBvcHVwXCIsIG92ZXJsYXksIGFkZGl0aW9uYWxDbGFzcykgOiBoaWRlT3ZlcmxheShcInBvcHVwXCIsIG92ZXJsYXkpO1xuICB9XG5cbiAgLy8gLS0tLS0tLUV2ZW50cy0tLS0tLS0tICBcblxuICAkKCdib2R5Jykub24oJ2NsaWNrJywgJyNwYWdlT3ZlcmxheScsIGZ1bmN0aW9uKGUpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhlKVxuICAgIGdsb2JGdW5jLmhpZGVPdmVybGF5KFwicG9wdXBcIiwgdGhpcywgYWRkaXRpb25hbENsYXNzU3RyKTtcblxuICAgIGlmIChtb2RhbHMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbW9kYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG1vZGFsc1tpXS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzX29wZW4nKSA/IGNsb3NlUG9wdXAobW9kYWxzW2ldKSA6IG51bGw7XG4gICAgICB9ICAgICAgIFxuICAgIH1cbiAgfSk7XG4gICBcbiAgJCgnYm9keScpLm9uKCdjbGljaycsICdidXR0b24ucG9wdXBDbG9zZUJ1dHRvbicsIGZ1bmN0aW9uKCkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdvaycpXG5cbiAgICBjbG9zZVBvcHVwKCAkKHRoaXMpLmNsb3Nlc3QoJy5wb3B1cCcpICk7XG4gICAgZ2xvYkZ1bmMuaGlkZU92ZXJsYXkoXCJwb3B1cFwiLCBwYWdlT3ZlcmxheSwgYWRkaXRpb25hbENsYXNzU3RyKTtcbiAgfSk7XG5cbiAgJCgnYm9keScpLm9uKCdtb3VzZWRvd24nLCAnLnBvcHVwJywgZnVuY3Rpb24oZSkge1xuICAgIC8vIGNvbnNvbGUubG9nKGUudGFyZ2V0KVxuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwJykpIHtcbiAgICAgIGNsb3NlUG9wdXAoIGUudGFyZ2V0ICk7XG4gICAgICBnbG9iRnVuYy5oaWRlT3ZlcmxheShcInBvcHVwXCIsIHBhZ2VPdmVybGF5LCBhZGRpdGlvbmFsQ2xhc3NTdHIpO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luZG93Lm9ua2V5ZG93biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMjcgKSB7XG4gICAgICBpZiAocGFnZU92ZXJsYXkpIHtcbiAgICAgICAgcGFnZU92ZXJsYXkuY2xhc3NMaXN0LmNvbnRhaW5zKCdqc19vcGVuJykgPyBnbG9iRnVuYy5oaWRlT3ZlcmxheShcInBvcHVwXCIsIHBhZ2VPdmVybGF5LCBhZGRpdGlvbmFsQ2xhc3NTdHIpIDogbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKG1vZGFscykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1vZGFscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIG1vZGFsc1tpXS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzX29wZW4nKSA/IGNsb3NlUG9wdXAobW9kYWxzW2ldKSA6IG51bGw7XG4gICAgICAgIH0gICAgICAgXG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8vIC0tLS0tLS0tLS0tLVxuXG4gIHJldHVybiB7XG4gICAgb3BlblBvcHVwOiBvcGVuUG9wdXAsXG4gICAgY2xvc2VQb3B1cDogY2xvc2VQb3B1cCxcbiAgfVxuXG59KSgpO1xuXG4vLyBnbG9iLlBvcHVwTW9kdWxlKClcblxuLy8gKGZ1bmN0aW9uKCkge1xuXG5cblxuLy8gfSkuY2FsbChnbG9iLlBvcHVwTW9kdWxlLnByb3RvdHlwZSkqL1xuICAvKlZhbGlkYXRpb25Nb2R1bGUgPSAoZnVuY3Rpb24oKSB7XG5cdGZ1bmN0aW9uIHZhbGlkYXRlKGlucHV0RWxlbWVudCwgdmFsaWRhdGlvbnNBcnJheSkge1xuXHRcdGNvbnN0IHZhbGlkYXRpb25zID0gdmFsaWRhdGlvbnNBcnJheTtcblx0XHRsZXQgbWVzc2FnZXMgPSBbXTtcblxuXHRcdGZ1bmN0aW9uIGlzTnVtYmVyKGlucHV0KSB7XG5cdFx0XHRyZXR1cm4gIWlzTmFOKHBhcnNlRmxvYXQoaW5wdXQudmFsdWUpKSAmJiBpc0Zpbml0ZShpbnB1dC52YWx1ZSk7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gaXNFbWFpbChpbnB1dCkge1xuXHRcdFx0dmFyIHJlZ2V4ID0gL14oW2EtekEtWjAtOV8uKy1dKStcXEAoKFthLXpBLVowLTktXSkrXFwuKSsoW2EtekEtWjAtOV17Miw0fSkrJC87XG5cdFx0XHRcblx0XHRcdHJldHVybiByZWdleC50ZXN0KGlucHV0LnZhbHVlKTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBpc0VtcHR5KGlucHV0KSB7XG5cdFx0XHRyZXR1cm4gaW5wdXQudmFsdWUucmVwbGFjZSgvXFxzL2csXCJcIikubGVuZ3RoID8gZmFsc2UgOiB0cnVlO1xuXHRcdH1cblxuXHRcdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB2YWxpZGF0aW9ucy5sZW5ndGg7IGkrKykge1xuXG5cdFx0XHRzd2l0Y2ggKHZhbGlkYXRpb25zW2ldKSB7XG5cdFx0XHRcdGNhc2UgJ3JlcXVpcmVkJzogXG5cdFx0XHRcdFx0aWYgKCBpc0VtcHR5KGlucHV0RWxlbWVudCkgKSB7XG5cdFx0XHRcdFx0XHRtZXNzYWdlcy5wdXNoKGlucHV0RWxlbWVudC5kYXRhc2V0LmVycm9yVGV4dClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGNhc2UgJ2lzTnVtYmVyJzogXG5cdFx0XHRcdFx0aWYgKCAhaXNOdW1iZXIoaW5wdXRFbGVtZW50KSApIHtcblx0XHRcdFx0XHRcdG1lc3NhZ2VzLnB1c2goaW5wdXRFbGVtZW50LmRhdGFzZXQuZXJyb3JUZXh0KVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0Y2FzZSAnaXNFbWFpbCc6IFxuXHRcdFx0XHRcdGlmICggIWlzRW1haWwoaW5wdXRFbGVtZW50KSApIHtcblx0XHRcdFx0XHRcdG1lc3NhZ2VzLnB1c2goaW5wdXRFbGVtZW50LmRhdGFzZXQuZXJyb3JUZXh0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGRlZmF1bHQ6IGNvbnNvbGUuZXJyb3IoJ2ludmFsaWQgaW5wdXQgZGF0YS12YWxpZGF0ZSB2YWx1ZScpXG5cblx0XHRcdH1cblx0XHR9XG5cdFx0Ly8gY29uc29sZS5sb2cobWVzc2FnZXMubGVuZ3RoID8gbWVzc2FnZXMgOiBudWxsKVxuXHRcdHJldHVybiBtZXNzYWdlcy5sZW5ndGggPyBtZXNzYWdlcyA6IG51bGw7XG5cdH1cblxuXHRmdW5jdGlvbiBzaG93V2FybmluZyhpbnB1dEVsZW1lbnQsIG1lc3NhZ2VzLCB0ZXh0Q29sb3IpIHtcblx0XHRpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnanNfY29udGFpbnNFcnJvcicpO1xuXHRcdGxldCB3YXJuaW5nTGlzdCA9ICQoJzx1bCBjbGFzcz1cImpzX3dhcm5pbmctbGlzdFwiPjwvdWw+Jyk7XG5cblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IG1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRsZXQgbGlzdEVsZW1lbnQgPSAkKFwiPGxpPjwvbGk+XCIpLnRleHQobWVzc2FnZXNbaV0pO1xuXHRcdFx0dGV4dENvbG9yID8gbGlzdEVsZW1lbnQuY3NzKCdjb2xvcicsIHRleHRDb2xvcikgOiBudWxsO1xuXHRcdFx0d2FybmluZ0xpc3QuYXBwZW5kKGxpc3RFbGVtZW50KVxuXHRcdH1cblx0XHRcblx0XHQkKGlucHV0RWxlbWVudCkuYWZ0ZXIod2FybmluZ0xpc3QpXG5cdH1cblxuXHRmdW5jdGlvbiBpc1ZhbGlkKGZvcm1FbGVtZW50KSB7XG5cdFx0Y29uc3QgZm9ybSA9IGZvcm1FbGVtZW50IGluc3RhbmNlb2YgalF1ZXJ5ID8gZm9ybUVsZW1lbnRbMF0gOiBmb3JtRWxlbWVudDtcblx0XHRjb25zdCBpbnB1dHMgPSBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXZhbGlkYXRlXScpO1xuXHRcdGxldCBlcnJvcnNDb3VudGVyID0gMDtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRsZXQgZXJyb3JNZXNzYWdlcyA9IFtdO1xuXHRcdFx0bGV0IHRleHRDb2xvciA9IGlucHV0c1tpXS5kYXRhc2V0LnRleHRDb2xvcjtcblxuXHRcdFx0JChpbnB1dHNbaV0pLnJlbW92ZUNsYXNzKFwianNfY29udGFpbnNFcnJvclwiKTtcblx0XHRcdCQoaW5wdXRzW2ldKS5uZXh0KCcuanNfd2FybmluZy1saXN0JykucmVtb3ZlKCk7XG5cblx0XHRcdGxldCB2YWxpZGF0aW9uc0FycmF5ID0gW107XG5cdFx0XHRsZXQgaW5wdXREYXRhID0gaW5wdXRzW2ldLmRhdGFzZXQudmFsaWRhdGUgPyBpbnB1dHNbaV0uZGF0YXNldC52YWxpZGF0ZS5zcGxpdCgnICcpIDogZmFsc2U7XG5cblx0XHRcdC8vIC0tLS0tLS0tLVxuXHRcdFx0aW5wdXRzW2ldLnZhbHVlID0gaW5wdXRzW2ldLnZhbHVlLnRyaW0oKTtcblx0XHRcdC8vIC0tLS0tLS0tLVxuXG5cdFx0XHR2YWxpZGF0aW9uc0FycmF5ID0gaW5wdXREYXRhID8gaW5wdXREYXRhIDogbnVsbDtcblx0XHRcdC8vIGlucHV0c1tpXS5yZXF1aXJlZCA/IHZhbGlkYXRpb25zQXJyYXkucHVzaCgncmVxdWlyZWQnKSA6IG51bGw7XG5cdFx0XHRcblx0XHRcdGlmICh2YWxpZGF0aW9uc0FycmF5Lmxlbmd0aCkge1xuXHRcdFx0XHRsZXQgdmFsaWRhdGlvblJlc3VsdCA9IHZhbGlkYXRlKGlucHV0c1tpXSwgdmFsaWRhdGlvbnNBcnJheSk7XG5cdFx0XHRcdHZhbGlkYXRpb25SZXN1bHQgPyBlcnJvck1lc3NhZ2VzID0gdmFsaWRhdGlvblJlc3VsdCA6IG51bGw7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChlcnJvck1lc3NhZ2VzLmxlbmd0aCkgeyBcblx0XHRcdFx0c2hvd1dhcm5pbmcoaW5wdXRzW2ldLCBlcnJvck1lc3NhZ2VzLCB0ZXh0Q29sb3IpO1xuXHRcdFx0XHRlcnJvcnNDb3VudGVyKys7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGVycm9yc0NvdW50ZXIgPiAwID8gZmFsc2UgOiB0cnVlO1xuXHR9XG5cblx0Ly8gLS0tLS0tLS0tLS0tLS0tXG5cdHJldHVybiB7XG5cdFx0aXNWYWxpZDogaXNWYWxpZCxcblx0fVxufSkoKVxuXG4vLyAtLS0tLS0tLS1WYWxpZGF0aW9uIFNjcmlwdCBUZXN0LS0tLS0tLS0tLS0tLVxuXG4vLyAkKCdib2R5Jykub24oJ2NsaWNrJywgJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJywgZnVuY3Rpb24oZSkge1xuLy8gXHQvLyBjb25zb2xlLmxvZygnb2snKVxuLy8gXHRlLnByZXZlbnREZWZhdWx0KCk7XG5cbi8vIFx0Ly8gVmFsaWRhdGlvbk1vZHVsZS5pc1ZhbGlkKHRoaXMuZm9ybSlcbi8vIFx0aWYoICFWYWxpZGF0aW9uTW9kdWxlLmlzVmFsaWQodGhpcy5mb3JtKSApIHtcbi8vIFx0XHRjb25zb2xlLmxvZygnZm9ybSBub3QgdmFsaWQ6ICcsIHRoaXMuZm9ybSlcbi8vIFx0fSBlbHNlIHtcbi8vIFx0XHRjb25zb2xlLmxvZygnZm9ybSB2YWxpZDogJywgdGhpcy5mb3JtKVxuLy8gXHR9XG4vLyB9KSovXG5cdC8qZ2xvYi5BbmltYXRlQm9yZGVyID0gZnVuY3Rpb24gKGFuaW1hdGVkQmxvY2tzLCBvcHRpb25zT2JqKSB7XG5cblx0dmFyIGFuaW1hdGVkRGFzaEJsb2NrcyA9IGFuaW1hdGVkQmxvY2tzO1xuXHR2YXIgb3B0aW9ucyA9IG9wdGlvbnNPYmo7XG5cblx0Ly8gY29uc29sZS5sb2cob3B0aW9ucy5zaGFkZWRTZWN0aW9uKTtcblx0Ly8gLS0tLS0tLS0tLSBNZXRob2RzIC0tLS0tLS0tXG5cblx0ZnVuY3Rpb24gZ2V0VG90YWxMZW5ndGgocGFyZW50QmxvY2ssIHJlY3QpIHtcblx0XHQvLyB2YXIgcmFkaXVzID0gK3JlY3QuZ2V0QXR0cmlidXRlKCdyeCcpO1xuXHRcdHZhciBsZW5ndGggPSAwO1xuXHRcdHZhciByZWN0V2lkdGggPSBwYXJlbnRCbG9jay5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCAtIChvcHRpb25zLmJvcmRlcldpZHRoICogMik7XG5cdFx0dmFyIHJlY3RIZWlnaHQgPSBwYXJlbnRCbG9jay5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgLSAob3B0aW9ucy5ib3JkZXJXaWR0aCAqIDIpO1xuXHRcdHZhciByYWRpdXMgPSBvcHRpb25zLnJhZGl1cyA/IHJlY3RIZWlnaHQgLyAyIDogbnVsbDtcblx0XHQvLyBjb25zb2xlLmxvZyhwYXJlbnRCbG9jay5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aClcblx0XHRpZiAocmFkaXVzKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRsZW5ndGg6ICsoIChyZWN0V2lkdGggLSByYWRpdXMqMikgKiAyICkgKyAoIDIqMy4xNCAqIHJhZGl1cyApLFxuXHRcdFx0XHRyYWRpdXM6IHJhZGl1c1xuXHRcdFx0fSBcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0bGVuZ3RoOiArKCByZWN0V2lkdGggKyByZWN0SGVpZ2h0ICkgKiAyXG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0RGFzaEFycmF5U3RyaW5nKHJlY3QsIHJlY3RMZW5ndGgpIHtcblx0XHR2YXIgZGFzaFRvdGFsTGVuZ3RoID0gb3B0aW9ucy5zaGFkZWRTZWN0aW9uICsgb3B0aW9ucy50cmFuc3BhcmVudFNlY3Rpb247XG5cblx0XHR2YXIgZGFzaFF1YW50aXR5ID0gTWF0aC5yb3VuZCggcmVjdExlbmd0aCAvIGRhc2hUb3RhbExlbmd0aCApXG5cdFx0dmFyIGRpZmZlcmVuY2UgPSAoIGRhc2hUb3RhbExlbmd0aCpkYXNoUXVhbnRpdHkgLSByZWN0TGVuZ3RoICkgLyBkYXNoUXVhbnRpdHk7XG5cdFx0XG5cdFx0ZGlmZmVyZW5jZSA9ICggTWF0aC5yb3VuZChkaWZmZXJlbmNlICogMTApIC8gMTAgKSAvIDI7XG5cblx0XHRvcHRpb25zLm5ld1NoYWRlZFNlY3Rpb24gPSBvcHRpb25zLnNoYWRlZFNlY3Rpb24gLSBkaWZmZXJlbmNlO1xuXHRcdG9wdGlvbnMubmV3VHJhbnNwYXJlbnRTZWN0aW9uID0gb3B0aW9ucy50cmFuc3BhcmVudFNlY3Rpb24gLSBkaWZmZXJlbmNlO1xuXG5cdFx0cmV0dXJuIG9wdGlvbnMubmV3U2hhZGVkU2VjdGlvbiArICcgJyArIG9wdGlvbnMubmV3VHJhbnNwYXJlbnRTZWN0aW9uO1xuXHR9XG5cblx0ZnVuY3Rpb24gY3ljbGVPZmZzZXQoZXZlbnQsIGFuaW1hdGVkQmxvY2ssIGRhc2hBcnJheVN1bU51bWJlcikge1xuXHQgIGlmICggZXZlbnQucHJvcGVydHlOYW1lID09ICdzdHJva2UtZGFzaG9mZnNldCcgKSB7XG5cdCAgXHQvLyBjb25zb2xlLmxvZygnc3Ryb2tlLWRhc2hvZmZzZXQnKVxuXHQgIFx0YW5pbWF0ZWRCbG9jay5jbGFzc0xpc3QuYWRkKCdqc19yZXNldFRyYW5zaXRpb24nKTtcblx0ICBcdGFuaW1hdGVkQmxvY2suc2V0QXR0cmlidXRlKCdzdHJva2UtZGFzaG9mZnNldCcsIDApO1xuXHQgIFx0XG5cdCAgXHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHQgIFx0XHRhbmltYXRlZEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2pzX3Jlc2V0VHJhbnNpdGlvbicpO1xuXHQgIFx0XHRhbmltYXRlZEJsb2NrLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLWRhc2hvZmZzZXQnLCBkYXNoQXJyYXlTdW1OdW1iZXIpXHRcdFx0XG5cdCAgXHR9LCAxMClcblx0ICB9XG5cdH1cblxuXHR2YXIgZXZlbnRIYW5kbGVyID0gZnVuY3Rpb24oZXZlbnQpIHtcblx0XHQvLyBjb25zb2xlLmxvZygnZXZlbnQ6ICcpXG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0Y3ljbGVPZmZzZXQoZXZlbnQsIHRoaXMsIHRoaXMuZGF0YXNldC5kYXNoQXJyYXlTdW0pXG5cdH1cblxuXHQvLyAtLS0tLS0tLS0tIEFjdGlvbiAtLS0tLS0tLVxuXG5cdGlmIChhbmltYXRlZERhc2hCbG9ja3MubGVuZ3RoKSB7XG5cblx0XHR2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhbmltYXRlZERhc2hCbG9ja3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0dmFyIHJlY3QgPSBhbmltYXRlZERhc2hCbG9ja3NbaV0ucXVlcnlTZWxlY3RvcigncmVjdC5hbmltYXRlZEJsb2NrJyk7XG5cdFx0XHRcdHZhciB0b3RhbExlbmd0aCA9IDAsIHJlc3VsdERhc2hBcnJheVN0cmluZyA9ICcnLCBkYXNoQXJyYXlTdW0gPSAwLCByYWRpdXMgPSAwO1xuXHRcdFx0XHRcblx0XHRcdFx0cmVjdC5yZW1vdmVFdmVudExpc3RlbmVyKFwidHJhbnNpdGlvbmVuZFwiLCBldmVudEhhbmRsZXIpO1xuXG5cdFx0XHRcdHRvdGFsTGVuZ3RoID0gZ2V0VG90YWxMZW5ndGgoIGFuaW1hdGVkRGFzaEJsb2Nrc1tpXSwgcmVjdCApO1xuXHRcdFx0XHRyYWRpdXMgPSB0b3RhbExlbmd0aC5yYWRpdXM7XG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKHRvdGFsTGVuZ3RoLmxlbmd0aClcblx0XHRcdFx0cmVzdWx0RGFzaEFycmF5U3RyaW5nID0gZ2V0RGFzaEFycmF5U3RyaW5nKHJlY3QsIHRvdGFsTGVuZ3RoLmxlbmd0aCk7XG5cdFx0XHRcdGRhc2hBcnJheVN1bSA9IE1hdGgucm91bmQoIG9wdGlvbnMubmV3U2hhZGVkU2VjdGlvbiArIG9wdGlvbnMubmV3VHJhbnNwYXJlbnRTZWN0aW9uICk7XG5cdFx0XHRcdGRhc2hBcnJheVN1bSA9IG9wdGlvbnMucmV2ZXJzZSA/IGRhc2hBcnJheVN1bSA6IGRhc2hBcnJheVN1bSAqIC0xO1xuXG5cdFx0XHRcdHJlY3Quc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCBvcHRpb25zLmJvcmRlcldpZHRoKTtcblx0XHRcdFx0cmFkaXVzID8gcmVjdC5zZXRBdHRyaWJ1dGUoJ3J4JywgcmFkaXVzKSA6IG51bGw7XG5cdFx0XHRcdHJlY3Quc2V0QXR0cmlidXRlKCdzdHJva2UtZGFzaGFycmF5JywgcmVzdWx0RGFzaEFycmF5U3RyaW5nKTtcblx0XHRcdFx0cmVjdC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS1kYXNob2Zmc2V0JywgZGFzaEFycmF5U3VtKjIpO1xuXHRcdFx0XHRyZWN0LnNldEF0dHJpYnV0ZSgnZGF0YS1kYXNoQXJyYXlTdW0nLCBkYXNoQXJyYXlTdW0qMik7XG5cblx0XHRcdFx0cmVjdC5hZGRFdmVudExpc3RlbmVyKFwidHJhbnNpdGlvbmVuZFwiLCBldmVudEhhbmRsZXIpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGluaXQoKTtcblxuXHRcdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXHRcdHZhciB0aW1lciA9IG51bGw7XG5cdFx0d2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24oZXZlbnQpIHtcblx0XHQgIGlmICh0aW1lcikgeyBjbGVhclRpbWVvdXQodGltZXIpOyB9XG5cblx0XHQgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHQgICAgdGltZXIgPSBudWxsO1xuXG5cdFx0ICAgIC8vIHlvdXIgZXZlbnQgaGFuZGxpbmcgbG9naWMgaGVyZVxuXHRcdCAgICAvLyBjb25zb2xlLmxvZygncmVzaXplJylcblx0XHQgICAgaW5pdCgpXG5cblx0XHQgIH0sIDUwKTtcblx0XHR9O1xuXG5cdH1cblxufVxuXG4qL1xuICAvKi8vIGpRdWVyeSgnPGRpdiBjbGFzcz1cInF1YW50aXR5LW5hdlwiPjxkaXYgY2xhc3M9XCJxdWFudGl0eS1idXR0b24gcXVhbnRpdHktdXBcIj48L2Rpdj48ZGl2IGNsYXNzPVwicXVhbnRpdHktYnV0dG9uIHF1YW50aXR5LWRvd25cIj48L2Rpdj48L2Rpdj4nKS5pbnNlcnRBZnRlcignLnF1YW50aXR5IGlucHV0Jyk7XG5qUXVlcnkoJy5jdXN0b20tcXVhbnRpdHknKS5lYWNoKGZ1bmN0aW9uKCkge1xuICB2YXIgc3Bpbm5lciA9IGpRdWVyeSh0aGlzKSxcbiAgaW5wdXQgPSBzcGlubmVyLmZpbmQoJ2lucHV0W3R5cGU9XCJudW1iZXJcIl0nKSxcbiAgYnRuVXAgPSBzcGlubmVyLmZpbmQoJy5xdWFudGl0eS11cCcpLFxuICBidG5Eb3duID0gc3Bpbm5lci5maW5kKCcucXVhbnRpdHktZG93bicpLFxuICBtaW4gPSBpbnB1dC5hdHRyKCdtaW4nKSxcbiAgbWF4ID0gaW5wdXQuYXR0cignbWF4Jyk7XG5cbiAgYnRuVXAuY2xpY2soZnVuY3Rpb24oKSB7XG5cbiAgICB2YXIgb2xkVmFsdWUgPSBwYXJzZUZsb2F0KGlucHV0LnZhbCgpKTtcbiAgICBpZiAob2xkVmFsdWUgPj0gbWF4KSB7XG4gICAgICAgIHZhciBuZXdWYWwgPSBvbGRWYWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbmV3VmFsID0gb2xkVmFsdWUgKyAxO1xuICAgIH1cblxuICAgIHNwaW5uZXIuZmluZChcImlucHV0XCIpLnZhbChuZXdWYWwpO1xuXG4gICAgc3Bpbm5lci5maW5kKFwiaW5wdXRcIikudHJpZ2dlcihcImNoYW5nZVwiKTtcblxuICB9KTtcblxuICBidG5Eb3duLmNsaWNrKGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIG9sZFZhbHVlID0gcGFyc2VGbG9hdChpbnB1dC52YWwoKSk7XG4gICAgaWYgKG9sZFZhbHVlIDw9IG1pbikge1xuICAgICAgICB2YXIgbmV3VmFsID0gb2xkVmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG5ld1ZhbCA9IG9sZFZhbHVlIC0gMTtcbiAgICB9XG4gICAgc3Bpbm5lci5maW5kKFwiaW5wdXRcIikudmFsKG5ld1ZhbCk7XG4gICAgc3Bpbm5lci5maW5kKFwiaW5wdXRcIikudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgfSk7XG5cbn0pOyovXG4gIC8qZ2xvYi5BY2NvcmRpb25Nb2R1bGUgID0gKGZ1bmN0aW9uKCkge1xuXHQvLyBjb25zb2xlLmxvZygnQWNjb3JkaW9uTW9kdWxlIG9rJyk7XG5cdFxuXHRmdW5jdGlvbiB0b2dnbGVDb250ZW50KG9wdGlvbnMsIGJ1dHRvbiwgdGFyZ2V0QmxvY2ssIGFsbFRhcmdldEJsb2Nrcykge1xuXHRcdGxldCBzdWJNZW51UGFyZW50cyA9IGJ1dHRvbiA/IGZpbmRBbGxQYXJlbnRzKGJ1dHRvbiwgJ3N1Ym1lbnVXcmFwcGVyJykgOiBudWxsO1xuXHRcdGxldCB0YXJnZXRIZWlnaHQgPSB0YXJnZXRCbG9jayA/IHRhcmdldEJsb2NrLmZpcnN0RWxlbWVudENoaWxkLm9mZnNldEhlaWdodCA6IG51bGw7XG5cblx0XHQvLyBjb25zb2xlLmxvZyhzdWJNZW51UGFyZW50cylcblxuXHRcdGZ1bmN0aW9uIGZpbmRBbGxQYXJlbnRzKGVsZW1lbnQsIHNlYXJjaENsYXNzKSB7XG5cdFx0XHR2YXIgZmluZGVkID0gZmFsc2U7XG5cdFx0XHR2YXIgY3VycmVudEVsZW1lbnQgPSBlbGVtZW50LCBmaW5kaW5nRWxlbWVudHMgPSBbXTtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHdoaWxlKCFmaW5kZWQpIHtcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coY3VycmVudEVsZW1lbnQucGFyZW50RWxlbWVudClcblx0XHRcdFx0XHR2YXIgcGFyZW50ID0gY3VycmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcblxuXHRcdFx0XHRcdGlmICggcGFyZW50LmNsYXNzTGlzdC5jb250YWlucyhzZWFyY2hDbGFzcykgKSB7XG5cdFx0XHRcdFx0XHRmaW5kaW5nRWxlbWVudHMucHVzaChwYXJlbnQpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAocGFyZW50LmNsYXNzTGlzdC5jb250YWlucygnbWFpblN1Ym1lbnVXcmFwcGVyJykpIHtcblx0XHRcdFx0XHRcdGZpbmRlZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRmaW5kaW5nRWxlbWVudHMucHVzaChjdXJyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50KTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAocGFyZW50LmNsYXNzTGlzdC5jb250YWlucygnYWNjb3JkaW9uTWVudScpKSBicmVhaztcblx0XHRcdFx0XHRjdXJyZW50RWxlbWVudCA9IHBhcmVudDtcblx0XHRcdFx0fVx0XHRcdFx0XG5cdFx0XHR9IGNhdGNoKGVycm9yKSB7Y29uc29sZS5sb2coZXJyb3IpfVxuXG5cdFx0XHQvLyBjb25zb2xlLmxvZyhjdXJyZW50RWxlbWVudClcblx0XHRcdHJldHVybiBmaW5kaW5nRWxlbWVudHM7XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gcmVzZXREcm9wRG93bih0YXJnZXRFbGVtZW50cykge1xuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXRFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHR0YXJnZXRFbGVtZW50c1tpXS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXHRcdFx0XHR0YXJnZXRFbGVtZW50c1tpXS5zdHlsZS5oZWlnaHQgPSBcIlwiO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIGNsb3NlU2libGluZ3MoYnV0dG9uLCB0YXJnZXRFbGVtZW50cykge1xuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXRFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRsZXQgYnV0dG9uID0gdGFyZ2V0RWxlbWVudHNbaV0ucGFyZW50RWxlbWVudFxuXHRcdFx0XHRpZiAoYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykgKSB7XG5cdFx0XHRcdFx0YnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuXHRcdFx0XHRcdHRhcmdldEVsZW1lbnRzW2ldLnN0eWxlLmhlaWdodCA9IFwiMHB4XCI7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gZHJvcERvd24oYnV0dG9uLCB0YXJnZXRFbGVtZW50LCBzdWJNZW51UGFyZW50cykge1xuXHRcdFx0aWYgKCBidXR0b24uY2hlY2tlZCB8fCBidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSApIHtcblx0XHRcdFx0aWYgKHN1Yk1lbnVQYXJlbnRzLmxlbmd0aCkge1xuXHRcdFx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgc3ViTWVudVBhcmVudHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRcdHN1Yk1lbnVQYXJlbnRzW2ldLnN0eWxlLmhlaWdodCA9IHN1Yk1lbnVQYXJlbnRzW2ldLm9mZnNldEhlaWdodCArIHRhcmdldEhlaWdodCArICdweCc7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdHRhcmdldEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gdGFyZ2V0SGVpZ2h0ICsgJ3B4J1xuXHRcdFx0fSBlbHNlIHtcdFx0XHQgXG5cdFx0XHRcdHRhcmdldEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCIwcHhcIjtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzdWJNZW51UGFyZW50cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdHN1Yk1lbnVQYXJlbnRzW2ldLnN0eWxlLmhlaWdodCA9ICBzdWJNZW51UGFyZW50c1tpXS5vZmZzZXRIZWlnaHQgLSB0YXJnZXRIZWlnaHQgKyAncHgnO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXG5cblx0XHRzd2l0Y2ggKG9wdGlvbnMgIHx8ICdkZWZhdWx0Jykge1xuXG5cdFx0XHRjYXNlICd3aXRoU2libGluZ3MnOiBcblx0XHRcdFx0Y2xvc2VTaWJsaW5ncyhidXR0b24sIGFsbFRhcmdldEJsb2Nrcyk7XG5cdFx0XHRcdGRyb3BEb3duKGJ1dHRvbiwgdGFyZ2V0QmxvY2ssIHN1Yk1lbnVQYXJlbnRzKTtcblx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlICd3aXRob3V0U2libGluZ3MnOiBkcm9wRG93bihidXR0b24sIHRhcmdldEJsb2NrLCBzdWJNZW51UGFyZW50cyk7IGJyZWFrO1xuXG5cdFx0XHRjYXNlICdyZXNldERyb3BEb3duJzogcmVzZXREcm9wRG93bihhbGxUYXJnZXRCbG9ja3MpOyBicmVhaztcblxuXHRcdFx0ZGVmYXVsdDogY29uc29sZS5lcnJvcignbm8gY29ycmVjdCBvcHRpb24gdHlwZWQgaW4gdG9nZ2xlQ29udGVudCBmdW5jdGlvbicpO1xuXG5cdFx0fVxuXG5cdH1cbiAgICBcblx0Ly8gLS0tLS1SZXNpemUgRXZlbnQtLS0tLS1cblx0Ly8gY29uc3QgbW9iaWxlRmlsdGVyTWVudUJsb2NrcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNmaWx0ZXJXcmFwcGVyIC5maWx0ZXItaXRlbSAuZmlsdGVyLWNvbnRlbnQtd3JhcHBlcicpO1xuXG5cdC8vIGxldCB0aW1lciA9IG51bGw7XG5cblx0Ly8gd2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24gKCkge1xuXHQvLyBcdGlmICh0aW1lcikge1xuXHQvLyBcdFx0Y2xlYXJUaW1lb3V0KHRpbWVyKTtcblx0Ly8gXHR9XG5cblx0Ly8gXHR0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdC8vIFx0XHR0aW1lciA9IG51bGw7XG5cbiAvLyAgICAgLy8gPT09PT09PUhhbmRsZXJzPT09PT09PVxuIC8vICAgICAgaWYgKG1vYmlsZUZpbHRlck1lbnVCbG9ja3MpIHtcbiAvLyAgICAgIFx0aWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA+IDk5MSkge1xuXHQvLyBcdFx0XHRcdHRvZ2dsZUNvbnRlbnQoXCJyZXNldERyb3BEb3duXCIsIG51bGwsIG51bGwsIG1vYmlsZUZpbHRlck1lbnVCbG9ja3MpO1xuXHQvLyBcdFx0XHR9XG4gLy8gICAgICB9XG4gLy8gICAgIH0sIDUwKTtcblx0Ly8gfTtcblxuXHRcbi8vIC0tLS0tLS0tLS0tLVxuXG5cdHJldHVybiB7XG5cdFx0dG9nZ2xlQ29udGVudDogdG9nZ2xlQ29udGVudCxcblx0fVxuXG59KSgpKi9cbiAgLypnbG9iLlRvZ2dsZUNvbnRlbnRNb2R1bGUgID0gKGZ1bmN0aW9uKCkge1xuXHQvLyBjb25zb2xlLmxvZygnVG9nZ2xlQ29udGVudE1vZHVsZSBvaycpO1xuXHQvLyBjb25zb2xlLnRpbWUoJ1RvZ2dsZUNvbnRlbnQgTW9kdWxlIGxvYWQnKTtcblxuXHRmdW5jdGlvbiB0b2dnbGVDb250ZW50KGJ1dHRvbkVsZW1lbnQsIGRhdGEpIHtcblx0XHRsZXQgYnV0dG9uID0gYnV0dG9uRWxlbWVudCxcblx0XHRcdFx0YnV0dG9uRGF0YSA9IGRhdGEuYnV0dG9uRGF0YSxcblx0XHRcdFx0dGFyZ2V0cyA9IGRhdGEudGFyZ2V0cyxcblx0XHRcdFx0dGhpc1RhcmdldCA9IGRhdGEudGhpc0NvbnRlbnQsXG5cdFx0XHRcdHRhcmdldEJ1dHRvbnMgPSBkYXRhLnRhcmdldEJ1dHRvbnMsXG5cdFx0XHRcdHRhcmdldHNSZXZlcnNlID0gZGF0YS50YXJnZXRzUmV2ZXJzZTtcblxuXHRcdFx0Ly8gY29uc29sZS5sb2coZGF0YSlcblxuXHRcdFxuXHRcdC8vIC0tLS0tLU1ldGhvZHMtLS0tLS0tLVxuXG5cdFx0ZnVuY3Rpb24gZHJvcERvd24oYnV0dG9uLCB0YXJnZXRCbG9jaywgYWN0aW9uLCBidXR0b25zRWxlbWVudHMpIHtcblx0XHRcdGlmIChhY3Rpb24gPT09ICdzaG93JyApIHtcblx0XHRcdFx0YnV0dG9uLmNoZWNrZWQgfHwgYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykgPyBcblx0XHRcdFx0dGFyZ2V0QmxvY2suc3R5bGUuaGVpZ2h0ID0gdGFyZ2V0QmxvY2suZmlyc3RFbGVtZW50Q2hpbGQub2Zmc2V0SGVpZ2h0ICsgJ3B4JyA6XG5cdFx0XHRcdHRhcmdldEJsb2NrLnN0eWxlLmhlaWdodCA9IFwiMHB4XCI7XG5cdFx0XHR9XHRlbHNlIGlmIChhY3Rpb24gPT09ICdoaWRlUmV2ZXJzZScpIHtcblx0XHRcdFx0YnV0dG9uLmNoZWNrZWQgfHwgYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykgPyBcblx0XHRcdFx0dGFyZ2V0QmxvY2suc3R5bGUuaGVpZ2h0ID0gXCIwcHhcIiA6XG5cdFx0XHRcdHRhcmdldEJsb2NrLnN0eWxlLmhlaWdodCA9IHRhcmdldEJsb2NrLmZpcnN0RWxlbWVudENoaWxkLm9mZnNldEhlaWdodCArICdweCc7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0YXJnZXRCbG9jay5zdHlsZS5oZWlnaHQgPSBcIjBweFwiO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZ1bmN0aW9uIHNob3dIaWRlKGJ1dHRvbiwgdGFyZ2V0QmxvY2ssIGFjdGlvbiwgY3NzU2hvd0NsYXNzLCBjc3NIaWRlQ2xhc3MpIHtcblx0XHRcdGlmIChhY3Rpb24gPT09ICdzaG93JyApIHtcblx0XHRcdFx0YnV0dG9uLmNoZWNrZWQgfHwgYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykgPyBcblx0XHRcdFx0XHR0YXJnZXRCbG9jay5jbGFzc0xpc3QuYWRkKGNzc1Nob3dDbGFzcykgOiB0YXJnZXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKGNzc1Nob3dDbGFzcyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRidXR0b24uY2hlY2tlZCB8fCBidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSA/XG5cdFx0XHRcdFx0dGFyZ2V0QmxvY2suY2xhc3NMaXN0LmFkZChjc3NIaWRlQ2xhc3MpIDogdGFyZ2V0QmxvY2suY2xhc3NMaXN0LnJlbW92ZShjc3NIaWRlQ2xhc3MpO1xuXHRcdFx0fVx0XG5cdFx0fVxuXG5cdFx0Ly8gLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5cdFx0ZnVuY3Rpb24gY2xlYW5CdXR0b25zKHRhcmdldEVsZW1lbnRzKSB7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRhcmdldEVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHRhcmdldEVsZW1lbnRzW2ldLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykgPyBcblx0XHRcdFx0XHR0YXJnZXRFbGVtZW50c1tpXS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSA6IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZnVuY3Rpb24gdG9nZ2xlKHRhcmdldEJsb2NrcywgYWN0aW9uKSB7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyh0YXJnZXRCbG9ja3MpXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRhcmdldEJsb2Nrcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRzd2l0Y2ggKGJ1dHRvbkRhdGEubWVudVR5cGUgfHwgJ2RlZmF1bHQnKSB7XG5cdFx0XHRcdFx0Y2FzZSAnc2NhbGUnOiBzaG93SGlkZSggYnV0dG9uLCB0YXJnZXRCbG9ja3NbaV0sIGFjdGlvbiwgJ2pzX3Nob3dTY2FsZScsICdqc19oaWRlU2NhbGUnICk7IGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgJ2Ryb3AtZG93bic6IGRyb3BEb3duKCBidXR0b24sIHRhcmdldEJsb2Nrc1tpXSwgYWN0aW9uICk7IGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgJ2Ryb3AtbGVmdCc6IHNob3dIaWRlKCBidXR0b24sIHRhcmdldEJsb2Nrc1tpXSwgYWN0aW9uLCAnanNfc2hvd1NsaWRlX2xlZnQnLCAnanNfaGlkZVNsaWRlX2xlZnQnKTsgYnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSAnZHJvcC1yaWdodCc6IHNob3dIaWRlKCBidXR0b24sIHRhcmdldEJsb2Nrc1tpXSwgYWN0aW9uLCAnanNfc2hvd1NsaWRlX3JpZ2h0JywgJ2pzX2hpZGVTbGlkZV9yaWdodCcpOyBicmVhaztcblx0XHRcdFx0XHRjYXNlICdzaG93LWhpZGUnOiBzaG93SGlkZSggYnV0dG9uLCB0YXJnZXRCbG9ja3NbaV0sIGFjdGlvbiwgJ2pzX3Nob3cnLCAnanNfaGlkZScgKTsgYnJlYWs7XG5cblx0XHRcdFx0XHRkZWZhdWx0OiBjb25zb2xlLmVycm9yKCdubyBjb3JyZWN0IFwiZGF0YS1tZW51LXR5cGVcIiBhdHRyaWJ1dGUgaXMgc2V0IHRvIHRoZSBidXR0b24gZWxlbWVudCBpbiBIVE1MIScpO1xuXHRcdFx0XHR9XHRcdFx0XHRcdFx0XG5cdFx0XHR9ICAgICAgXG5cdFx0fVxuXG5cblx0XHRzd2l0Y2ggKGJ1dHRvbkRhdGEuYnV0dG9uVHlwZSB8fCAnZGVmYXVsdCcpIHtcblx0XHRcdGNhc2UgJ2NoZWNrYm94Jzpcblx0XHRcdGNhc2UgJ2J1dHRvbic6XG5cdFx0XHRjYXNlICdtZW51QnV0dG9uJzpcblx0XHRcdFx0XHR0b2dnbGUodGFyZ2V0cywgJ3Nob3cnKTtcblx0XHRcdFx0XHR0b2dnbGUodGFyZ2V0c1JldmVyc2UsICdoaWRlUmV2ZXJzZScpO1x0XHRcdFx0XHRcblx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlICdhY2NvcmRpb24nOiBcblx0XHRcdFx0aWYgKGJ1dHRvbkRhdGEuc2libGluZ3MgPT0gJ3llcycpIHtcblx0XHRcdFx0XHR0b2dnbGUodGFyZ2V0c1JldmVyc2UsICdoaWRlJyk7XG5cdFx0XHRcdFx0Y2xlYW5CdXR0b25zKHRhcmdldEJ1dHRvbnMpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRvZ2dsZSh0aGlzVGFyZ2V0LCAnc2hvdycpO1xuXHRcdFx0YnJlYWs7XG5cblx0XHRcdGRlZmF1bHQ6IGNvbnNvbGUuZXJyb3IoJ25vIGNvcnJlY3QgXCJkYXRhLWJ1dHRvbi10eXBlXCIgYXR0cmlidXRlIGlzIHNldCB0byB0aGUgYnV0dG9uIGVsZW1lbnQgaW4gSFRNTCEnKTtcblx0XHR9XG5cblx0fVxuXG5cdC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cblx0ZnVuY3Rpb24gdGFyZ2V0c0ZvckFjdGlvbihidXR0b25FbGVtZW50LCBidXR0b25EYXRhKSB7XG5cdFx0bGV0IHRhcmdldHNGb3JBY3Rpb25JZCA9IGJ1dHRvbkRhdGEudGFyZ2V0ID8gYnV0dG9uRGF0YS50YXJnZXQuc3BsaXQoJyAnKSA6IG51bGwsXG5cdFx0IFx0XHR0YXJnZXRzRm9yQWN0aW9uID0gW107XG5cblx0XHRpZiAodGFyZ2V0c0ZvckFjdGlvbklkKSB7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRhcmdldHNGb3JBY3Rpb25JZC5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHR0YXJnZXRzRm9yQWN0aW9uLnB1c2goIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhcmdldHNGb3JBY3Rpb25JZFtpXSkgKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdGFyZ2V0c0ZvckFjdGlvbjtcblx0fVxuXG5cdGZ1bmN0aW9uIHRhcmdldHNGb3JSZXZlcnNlQWN0aW9uKGJ1dHRvbkVsZW1lbnQsIGJ1dHRvbkRhdGEpIHtcblx0XHRsZXRcdHRhcmdldHNGb3JSZXZlcnNlQWN0aW9uSWQgPSBidXR0b25EYXRhLnRhcmdldFJldmVyc2UgPyBidXR0b25EYXRhLnRhcmdldFJldmVyc2Uuc3BsaXQoJyAnKSA6IG51bGwsXG5cdFx0XHRcdHRhcmdldHNGb3JBY3Rpb25Hcm91cCA9IGJ1dHRvbkRhdGEuZ3JvdXAgPyBidXR0b25EYXRhLmdyb3VwIDogbnVsbCxcblx0XHRcdFx0dGFyZ2V0c0ZvclJldmVyc2VBY3Rpb24gPSBbXTtcdFxuXG5cdFx0aWYgKHRhcmdldHNGb3JSZXZlcnNlQWN0aW9uSWQpIHtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0c0ZvclJldmVyc2VBY3Rpb25JZC5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHR0YXJnZXRzRm9yUmV2ZXJzZUFjdGlvbi5wdXNoKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXRzRm9yUmV2ZXJzZUFjdGlvbklkW2ldKSApO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAodGFyZ2V0c0ZvckFjdGlvbkdyb3VwKSB7XG5cdFx0XHR0YXJnZXRzRm9yUmV2ZXJzZUFjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGFyZ2V0c0ZvckFjdGlvbkdyb3VwKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGFyZ2V0c0ZvclJldmVyc2VBY3Rpb247XG5cdH1cblxuXHRmdW5jdGlvbiB0aGlzQ29udGVudFRhcmdldChidXR0b25FbGVtZW50LCBidXR0b25EYXRhKSB7XG5cdFx0bGV0IHRoaXNUYXJnZXQgPSBidXR0b25EYXRhLmdyb3VwID8gYnV0dG9uRWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYnV0dG9uRGF0YS5ncm91cCkgOiBudWxsO1xuXHRcdHJldHVybiB0aGlzVGFyZ2V0O1xuXHR9XG5cblx0ZnVuY3Rpb24gdGFyZ2V0c0ZvclJldmVyc2VBY3Rpb25CdXR0b25zKGJ1dHRvbkVsZW1lbnQsIGJ1dHRvbkRhdGEpIHtcblx0XHRsZXQgdGFyZ2V0QnV0dG9ucyA9IFtdO1xuXG5cdFx0aWYgKGJ1dHRvbkRhdGEuZ3JvdXApIHtcblx0XHRcdGxldCBidXR0b25zQWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNob3dCdXR0b25bZGF0YS1ncm91cD1cIicgKyBidXR0b25EYXRhLmdyb3VwICsgJ1wiXScgKTtcblxuXHRcdFx0aWYgKGJ1dHRvbnNBbGwpIHtcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBidXR0b25zQWxsLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0YnV0dG9uc0FsbFtpXSA9PT0gYnV0dG9uRWxlbWVudCA/IG51bGwgOiB0YXJnZXRCdXR0b25zLnB1c2goYnV0dG9uc0FsbFtpXSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdGFyZ2V0QnV0dG9ucztcdFxuXHR9XG5cblxuXHQvLyAtLS0tU2hvdyBDb250ZW50IEFjdGlvbnMgLS0tLS0tLS0tXG5cdCQoJ2JvZHknKS5vbignY2xpY2snLCAnLnNob3dCdXR0b24nLCBmdW5jdGlvbigpIHtcblx0XHQvLyBjb25zb2xlLnRpbWUoJ2NsaWNrIHRvZ2dsZSB3b3JraW5nIHRpbWUnKTtcblxuXHRcdGxldCB0YXJnZXRDb250ZW50RGF0YSA9IHt9O1xuXG5cblx0XHQvLyAtLS0tLSB0YXJnZXRDb250ZW50RGF0YSBjb25zdHJ1Y3Rvci0tLS0tLVxuXHRcdGlmICh0aGlzKSB7XG5cdFx0XHRsZXQgYnV0dG9uRGF0YSA9IHRoaXMuZGF0YXNldDtcblxuXHRcdFx0Ly8gY29uc29sZS5sb2coYnV0dG9uRGF0YSlcblx0XHRcdHRhcmdldENvbnRlbnREYXRhID0ge307XG5cdFx0XHR0YXJnZXRDb250ZW50RGF0YS5idXR0b25EYXRhID0gYnV0dG9uRGF0YTtcblx0XHRcdHRhcmdldENvbnRlbnREYXRhLnRhcmdldHMgPSB0YXJnZXRzRm9yQWN0aW9uKHRoaXMsIGJ1dHRvbkRhdGEgKTtcblx0XHRcdHRhcmdldENvbnRlbnREYXRhLnRhcmdldHNSZXZlcnNlID0gdGFyZ2V0c0ZvclJldmVyc2VBY3Rpb24odGhpcywgYnV0dG9uRGF0YSApO1xuXG5cdFx0XHRpZiAoYnV0dG9uRGF0YS5idXR0b25UeXBlID09PSBcImFjY29yZGlvblwiKSB7XG5cdFx0XHRcdHRhcmdldENvbnRlbnREYXRhLnRoaXNDb250ZW50ID0gdGhpc0NvbnRlbnRUYXJnZXQodGhpcywgYnV0dG9uRGF0YSk7XG5cdFx0XHRcdHRhcmdldENvbnRlbnREYXRhLnRhcmdldEJ1dHRvbnMgPSB0YXJnZXRzRm9yUmV2ZXJzZUFjdGlvbkJ1dHRvbnModGhpcywgYnV0dG9uRGF0YSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIC0tLS0tLS0tQWN0aW9ucy9FdmVudHMtLS0tLS0tLVxuXG5cdFx0XHRpZiAoYnV0dG9uRGF0YS5idXR0b25UeXBlID09PSBcIm1lbnVCdXR0b25cIikge1xuXHRcdFx0XHRnbG9iRnVuYy50b2dnbGVCdXR0b25Db250ZW50KHRoaXMpO1xuXHRcdFx0XHR0aGlzLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykgPyBcblx0XHRcdFx0XHRnbG9iRnVuYy5zaG93T3ZlcmxheShcIm1lbnVcIiwgZ2xvYi5wYWdlT3ZlcmxheSkgOiBcblx0XHRcdFx0XHRnbG9iRnVuYy5oaWRlT3ZlcmxheShcIm1lbnVcIiwgZ2xvYi5wYWdlT3ZlcmxheSk7XG5cblx0XHRcdFx0dG9nZ2xlQ29udGVudCh0aGlzLCB0YXJnZXRDb250ZW50RGF0YSk7XG5cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGdsb2JGdW5jLnRvZ2dsZUJ1dHRvbkNvbnRlbnQodGhpcyk7XG5cdFx0XHRcdHRvZ2dsZUNvbnRlbnQodGhpcywgdGFyZ2V0Q29udGVudERhdGEpO1x0XHRcdFx0XG5cdFx0XHR9XG5cblx0XHR9XG5cdFx0Ly8gY29uc29sZS50aW1lRW5kKCdjbGljayB0b2dnbGUgd29ya2luZyB0aW1lJyk7XG5cdFx0XHRcblx0fSk7XG5cblxufSkoKTsqL1xuICAvKmdsb2IuU3dpdGNoVGFic01vZHVsZSAgPSAoZnVuY3Rpb24oKSB7XG5cblx0Y29uc3QgZGVmYXVsdFRhYnNCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYnNOYXYgLnRhYkJ1dHRvbicpLFxuXHRkZWZhdWx0VGFic0Jsb2Nrc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b2dnbGVCbG9ja3MtbGlzdCcpLFxuXHRkZWZhdWx0VGFic0Jsb2Nrc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9nZ2xlQmxvY2snKTtcblxuXG5cdGZ1bmN0aW9uIHN3aXRjaFRhYnModGFiQnV0dG9uLCB0YWJzQmxvY2tzLCB0YWJCdXR0b25zKSB7XG5cdFx0bGV0IHRhcmdldCA9IHRhYkJ1dHRvbi5kYXRhc2V0LnRhcmdldDtcblxuXHRcdGlmICggIXRhYkJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpICkge1xuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0YWJzQmxvY2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHRhYkJ1dHRvbnNbaV0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cdFx0XHRcdHRhYnNCbG9ja3NbaV0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG5cblx0XHRcdFx0aWYgKHRhcmdldCA9PT0gdGFic0Jsb2Nrc1tpXS5pZCkge1xuXHRcdFx0XHRcdHRhYkJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgXG5cdFx0XHRcdFx0dGFic0Jsb2Nrc1tpXS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsgXG5cdFx0XHRcdH0gXG5cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuICAvLyAtLS1ldmVudHMtLS1cblxuICAkKCcudGFic05hdicpLm9uKCdjbGljaycsICcudGFiQnV0dG9uJywgZnVuY3Rpb24oKSB7XG4gIFx0XHR2YXIgdGFic0dyb3VwID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0aGlzLmRhdGFzZXQudGFic0dyb3VwKVxuICBcdFx0dmFyIHRhYkJ1dHRvbnMgPSB0aGlzLnBhcmVudEVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndGFiQnV0dG9uJylcbiAgXHRcdHZhciB0YWJzQmxvY2tzQ29udGFpbmVyID0gdGhpcy5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0aGlzLmRhdGFzZXQudGFic0NvbnRhaW5lcilbMF1cblxuICBcdFx0Ly8gY29uc29sZS5sb2codGFiQnV0dG9ucylcbiAgXHRcdC8vIGNvbnNvbGUubG9nKHRhYnNCbG9ja3NDb250YWluZXIpXG4gIFx0XHRpZiAodGFic0dyb3VwLmxlbmd0aCkge1x0c3dpdGNoVGFicyh0aGlzLCB0YWJzR3JvdXAsIHRhYkJ1dHRvbnMpO31cbiAgXHRcdGVsc2UgeyBzd2l0Y2hUYWJzKHRoaXMsIGRlZmF1bHRUYWJzQmxvY2tzTGlzdCwgdGFiQnV0dG9ucyk7XHR9XG5cbiAgXHRcdGlmICh0YWJzQmxvY2tzQ29udGFpbmVyKSB7Z2xvYkZ1bmMuYW5pbWF0ZUJsb2NrKHRhYnNCbG9ja3NDb250YWluZXIpO31cbiAgXHRcdGVsc2Uge2dsb2JGdW5jLmFuaW1hdGVCbG9jayhkZWZhdWx0VGFic0Jsb2Nrc0NvbnRhaW5lcik7fVx0ICBcdFx0XG4gIH0pXG5cblxufSkoKTsqL1xuICAvKmdsb2IuVGV4dExpbWl0TW9kdWxlICA9IChmdW5jdGlvbigpIHtcblx0Y29uc29sZS5sb2coJ1RleHRMaW1pdE1vZHVsZSBvaycpO1xuXG5cdGZ1bmN0aW9uIHNsaWNlVGV4dChzbGljaW5nQmxvY2tzLCBtYXhMZW5ndGgpIHtcblx0XHRpZiAoc2xpY2luZ0Jsb2Nrcykge1xuXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHNsaWNpbmdCbG9ja3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0bGV0IGN1cnJlbnRUZXh0ID0gc2xpY2luZ0Jsb2Nrc1tpXS5pbm5lckhUTUw7XG5cblx0XHRcdFx0aWYgKGN1cnJlbnRUZXh0Lmxlbmd0aCA+IG1heExlbmd0aCkge1xuXHRcdFx0XHRcdHNsaWNpbmdCbG9ja3NbaV0uaW5uZXJIVE1MID0gY3VycmVudFRleHQuc2xpY2UoMCwgbWF4TGVuZ3RoKSArICcgLi4uJztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0fVxuXHR9XG5cdFxuXHRyZXR1cm4ge1xuXHRcdHNsaWNlVGV4dDogc2xpY2VUZXh0LFxuXHR9XG5cbn0pKCk7Ki9cbiAgLypnbG9iLlN0aWNreUJsb2NrTW9kdWxlID0gKGZ1bmN0aW9uKCkge1xuXG4gIHZhciB0YXJnZXQ7XG4gIHZhciByZWxhdGl2ZTtcbiAgdmFyIGlzQWN0aXZlID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gdG9TdGljayh0YXJnZXRCbG9jaywgcmVsYXRpdmVCbG9jaykge1xuICAgIHRhcmdldCA9IHRhcmdldEJsb2NrO1xuICAgIHJlbGF0aXZlID0gcmVsYXRpdmVCbG9jaztcbiAgICBpc0FjdGl2ZSA9IHRydWU7XG4gICAgLy8gY2woJ2FjdGl2YXRlICcsIGlzQWN0aXZlKVxuXG4gICAgdG9TY3JvbGwoaXNBY3RpdmUpXG4gIH1cblxuICBmdW5jdGlvbiB1blN0aWNrKCkge1xuICAgIGlzQWN0aXZlID0gZmFsc2U7XG4gICAgLy8gY2woJ2RlYWN0aXZhdGUnKVxuICAgIHRvU2Nyb2xsKGlzQWN0aXZlKSAgICBcbiAgfVxuICBcbiAgZnVuY3Rpb24gY2hlY2tQb3NpdGlvbih0YXJnZXRCbG9jaywgcmVsYXRpdmVCbG9jaykge1xuICAgIGlmICggIWdsb2JGdW5jLmlzVmlzaWJsZShyZWxhdGl2ZUJsb2NrLCAndG9wQm9yZGVyJykgKSB7XG5cbiAgICAgIGlmICggIXRhcmdldEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnanNfZml4ZWRfbmF2JykgKSB7XG4gICAgICAgIHRhcmdldEJsb2NrLnN0eWxlLndpZHRoID0gdGFyZ2V0QmxvY2sub2Zmc2V0V2lkdGggKyAncHgnO1xuICAgICAgICB0YXJnZXRCbG9jay5jbGFzc0xpc3QuYWRkKCdqc19maXhlZF9uYXYnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGdsb2JGdW5jLmdldENvb3Jkc09uU2NyZWVuKHRhcmdldEJsb2NrKS5ib3R0b20gPj0gZ2xvYkZ1bmMuZ2V0Q29vcmRzT25TY3JlZW4ocmVsYXRpdmVCbG9jaykuYm90dG9tKSB7XG4gICAgICAgIHRhcmdldEJsb2NrLmNsYXNzTGlzdC5hZGQoJ2pzX2Fic29sdXRlX25hdicpO1xuICAgICAgICB0YXJnZXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdqc19maXhlZF9uYXYnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCB0YXJnZXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2pzX2Fic29sdXRlX25hdicpICkge1xuICAgICAgICBpZiAoZ2xvYkZ1bmMuaXNWaXNpYmxlKHRhcmdldEJsb2NrLCBcInRvcEJvcmRlclwiKSkge1xuICAgICAgICAgIHRhcmdldEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2pzX2Fic29sdXRlX25hdicpO1xuICAgICAgICAgIHRhcmdldEJsb2NrLmNsYXNzTGlzdC5hZGQoJ2pzX2ZpeGVkX25hdicpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCB0YXJnZXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2pzX2ZpeGVkX25hdicpICkge1xuICAgICAgICB0YXJnZXRCbG9jay5zdHlsZS53aWR0aCA9ICcnO1xuICAgICAgICB0YXJnZXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdqc19maXhlZF9uYXYnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB0b1Njcm9sbChzdGF0dXMpIHtcbiAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRhcmdldCAmJiByZWxhdGl2ZSkge1xuICAgICAgICAgIGNoZWNrUG9zaXRpb24odGFyZ2V0LCByZWxhdGl2ZSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cbiAgXG4gIFxuXG4gIHJldHVybiB7XG4gICAgdG9TdGljazogdG9TdGljayxcbiAgICB1blN0aWNrOiB1blN0aWNrLFxuICB9XG5cbn0pKCkqL1xuICAvKmdsb2IuTGF6eUxvYWRNb2R1bGUgID0gKGZ1bmN0aW9uKCkge1xuXHR2YXIgbGF6eUJsb2NrcyA9IFtdXG5cblx0ZnVuY3Rpb24gaW5pdChzZWxlY3Rvcikge1xuXHRcdHNldExhenkoc2VsZWN0b3IpO1xuXHRcdGxhenlMb2FkKGxhenlCbG9ja3MpO1xuXHR9XG5cblx0ZnVuY3Rpb24gc2V0TGF6eShjbGFzc1NlbGVjdG9yKXtcblx0XHQvLyBjb25zb2xlLmxvZyhzZWxlY3Rvcilcblx0XHRsYXp5QmxvY2tzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShjbGFzc1NlbGVjdG9yKTtcblx0XHRcdC8vIGNsKGxhenlCbG9ja3MubGVuZ3RoKVxuXHRcdGlmIChsYXp5QmxvY2tzLmxlbmd0aCkge1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBsYXp5QmxvY2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmICghbGF6eUJsb2Nrc1tpXS5nZXRBdHRyaWJ1dGUoJ2hhcy1wcmVsb2FkZXInKSkge1xuXHRcdFx0XHRcdHZhciBwcmVsb2FkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdFx0XHRwcmVsb2FkZXIuY2xhc3NOYW1lID0gJ2ltZ1ByZWxvYWRlcic7XG5cdFx0XHRcdFx0cHJlbG9hZGVyLmlubmVySFRNTCA9ICc8aW1nIHNyYz1cIi9pbWcvaWNvbnMvbGF6eV9wcmVsb2FkZXIuanBnXCIgYWx0PVwibG9hZGVyXCI+J1xuXHRcdFx0XHRcdGxhenlCbG9ja3NbaV0ucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChwcmVsb2FkZXIpO1xuXHRcdFx0XHRcdGxhenlCbG9ja3NbaV0uc2V0QXR0cmlidXRlKCdoYXMtcHJlbG9hZGVyJywgdHJ1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG4gICAgLy8gY29uc29sZS5sb2coJ0ZvdW5kICcgKyBsYXp5QmxvY2tzLmxlbmd0aCArICcgbGF6eSBpbWFnZXMnKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGxvYWRlZChlbCkge1xuICAgIC8vIGVsLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1zcmMnKTtcbiAgICAvLyBlbC5jbGFzc0xpc3QucmVtb3ZlKCdsYXp5QmxvY2snKTtcblx0XHRsZXQgbG9hZGVyID0gZWwucGFyZW50RWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdpbWdQcmVsb2FkZXInKVswXTtcblx0XHRpZiAobG9hZGVyKSAkKGxvYWRlcikuZmFkZU91dCgpO1xuXHRcdC8vIGNsZWFuTGF6eSgpXG5cdH1cblxuXHRmdW5jdGlvbiBsb2FkSW1hZ2UoZWxlbWVudCkge1xuXHRcdGlmKCBpc0luVmlld3BvcnQoZWxlbWVudCkgKSB7XG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaXNMb2FkaW5nJywgdHJ1ZSk7XG5cblx0XHRcdGlmIChlbGVtZW50LnRhZ05hbWUgIT09ICdJTUcnKSB7XG5cdFx0XHRcdHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcblx0XHRcdFx0dmFyIHNyY0RhdGEgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKTtcblx0XHRcdFx0aWYgKHNyY0RhdGEpIHsgXG5cdFx0XHRcdFx0aW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0ICBlbGVtZW50LnN0eWxlLmJhY2tncm91bmRJbWFnZSA9ICd1cmwoJyArIGltZy5nZXRBdHRyaWJ1dGUoJ3NyYycpICsgJyknO1xuXHRcdFx0XHRcdCAgbG9hZGVkKGVsZW1lbnQpO1xuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHQvLyBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1zcmMnKTtcblx0XHRcdFx0XHRpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBzcmNEYXRhKTsgXG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHZhciBzcmNEYXRhID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJyk7XG5cdFx0XHRcdGlmIChzcmNEYXRhKXtcblx0XHRcdFx0XHRlbGVtZW50Lm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0ICBsb2FkZWQoZWxlbWVudCk7XG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlKCdzcmMnLCBzcmNEYXRhKTsgXG5cdFx0XHRcdFx0Ly8gZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtc3JjJyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBsYXp5TG9hZChsYXp5QmxvY2tzKSB7XG5cdFx0Ly8gaWYgKGxhenlCbG9ja3MubGVuZ3RoKSB7XG5cdFx0XHRsZXQgbGF6eUIgPSBsYXp5QmxvY2tzO1xuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsYXp5Qi5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHR2YXIgaXNMb2FkaW5nID0gbGF6eUJbaV0uZ2V0QXR0cmlidXRlKCdpc0xvYWRpbmcnKTtcblx0XHRcdFx0aWYgKCBpc0xvYWRpbmcgIT0gJ3RydWUnICkge1xuXHRcdFx0XHRcdGxvYWRJbWFnZShsYXp5QltpXSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y2xlYW5MYXp5KClcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gY2xlYW5MYXp5KClcblx0XHQvLyB9XG5cdH1cblxuXHRmdW5jdGlvbiBjbGVhbkxhenkoKXtcblx0XHRpZiAobGF6eUJsb2Nrcy5sZW5ndGgpIHtcblx0XHRcdGxhenlCbG9ja3MgPSAgQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKGxhenlCbG9ja3MsIGZ1bmN0aW9uKGwpeyByZXR1cm4gbC5nZXRBdHRyaWJ1dGUoJ2lzTG9hZGluZycpICE9ICd0cnVlJzt9KTtcblx0XHR9XG5cdCAgICAvLyBjbChsYXp5QmxvY2tzLmxlbmd0aClcblx0fVxuXG5cblx0ZnVuY3Rpb24gaXNJblZpZXdwb3J0KGVsKXtcbiAgICB2YXIgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIFxuICAgIHJldHVybiAoXG4gICAgICAgIHJlY3QuYm90dG9tID49IDAgJiYgXG4gICAgICAgIC8vIHJlY3QucmlnaHQgPj0gMCAmJiBcbiAgICAgICAgcmVjdC50b3AgPD0gKHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KVxuICAgICAgICAvLyByZWN0LmxlZnQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aClcbiAgICApO1xuXHR9XG5cblx0dmFyIHRpbWVyID0gbnVsbDtcblx0JCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbiAoKSB7XG5cdFx0aWYgKHRpbWVyKSB7IGNsZWFyVGltZW91dCh0aW1lcik7IH1cblxuXHQgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICBcdHRpbWVyID0gbnVsbDtcblx0ICAgIFxuXHQgICAgLy8gc2V0TGF6eSgpO1xuXHQgICAgLy8gY2wobGF6eUJsb2Nrcy5sZW5ndGgpXG5cdCAgICBpZiAobGF6eUJsb2Nrcy5sZW5ndGgpIHsgbGF6eUxvYWQobGF6eUJsb2Nrcyk7IH1cblxuXHQgIH0sIDUwKTtcblx0fSlcblxuXHQvLyAtLS0tLS0tLS0tLS1cblxuXHRyZXR1cm4ge1xuXHQgIGluaXRMYXp5OiBpbml0LFxuXHQgIC8vIGxhenlMb2FkOiBsYXp5TG9hZCxcblx0fVxuXG5cbn0pKCk7Ki9cbiAgLypnbG9iLk9wZW5DbG9zZU1vZHVsZSAgPSAoZnVuY3Rpb24oKSB7XG5cdC8vIGNvbnNvbGUubG9nKCdPcGVuQ2xvc2VNb2R1bGUgb2snKTtcblx0Ly8gY29uc29sZS50aW1lKCdUb2dnbGVDb250ZW50IE1vZHVsZSBsb2FkJyk7XG5cblx0ZnVuY3Rpb24gaW5pdGlhdGUoYnV0dG9uRWxlbWVudCkge1xuXHRcdGxldCBidXR0b24gPSBidXR0b25FbGVtZW50LFxuXHRcdFx0XHRidXR0b25EYXRhID0gYnV0dG9uLmRhdGFzZXQsXG5cdFx0XHRcdHRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJ1dHRvbkRhdGEudGFyZ2V0KSxcblx0XHRcdFx0Y29udHJvbENsYXNzID0gYnV0dG9uRGF0YS5jbGFzcztcblxuXHRcdC8vIC0tLS0tLU1ldGhvZHMtLS0tLS0tLVxuXHRcdGlmICh0YXJnZXQgJiYgY29udHJvbENsYXNzKSB7XG5cblx0XHRcdGlmIChidXR0b25EYXRhLmFjdGlvbikge1xuXHRcdFx0XHRpZiAoYnV0dG9uRGF0YS5hY3Rpb24gPT0gJ29wZW4nKSB7XG5cdFx0XHRcdFx0Z2xvYkZ1bmMudG9nZ2xlQnV0dG9uQ29udGVudChidXR0b24pO1xuXHRcdFx0XHRcdHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoY29udHJvbENsYXNzKSA/IG51bGwgOiB0YXJnZXQuY2xhc3NMaXN0LmFkZChjb250cm9sQ2xhc3MpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGJ1dHRvbkRhdGEuYWN0aW9uID09ICdjbG9zZScpIHtcblx0XHRcdFx0XHR2YXIgdGhpc0dyb3VwT3BlbkJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcub3BlbkJ1dHRvbltkYXRhLXRhcmdldD1cIicgKyBidXR0b25EYXRhLnRhcmdldCArICdcIl0nICk7XG5cdFx0XHRcdFx0aWYgKHRoaXNHcm91cE9wZW5CdXR0b25zLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzR3JvdXBPcGVuQnV0dG9ucy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRcdFx0XHR0aGlzR3JvdXBPcGVuQnV0dG9uc1tpXS5kYXRhc2V0LmFjdGlvbiA9PSAnb3BlbicgPyBnbG9iRnVuYy50b2dnbGVCdXR0b25Db250ZW50KHRoaXNHcm91cE9wZW5CdXR0b25zW2ldKSA6IG51bGw7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoY29udHJvbENsYXNzKSA/IHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKGNvbnRyb2xDbGFzcykgOiBudWxsO1xuXHRcdFx0XHR9XG5cdFx0XHR9XHRlbHNlIHsgXG5cdFx0XHRcdGdsb2JGdW5jLnRvZ2dsZUJ1dHRvbkNvbnRlbnQoYnV0dG9uKTtcblx0XHRcdFx0dGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoY29udHJvbENsYXNzKTtcblx0XHRcdH1cblx0XHRcdFxuXHRcdH1cdFx0XHRcblx0fVxuXG5cdC8vIC0tLS1TaG93IENvbnRlbnQgQWN0aW9ucyAtLS0tLS0tLS1cblx0JCgnYm9keScpLm9uKCdjbGljaycsICcub3BlbkJ1dHRvbicsIGZ1bmN0aW9uKCkge1xuXHRcdC8vIGNvbnNvbGUudGltZSgnY2xpY2sgdG9nZ2xlIHdvcmtpbmcgdGltZScpO1xuXG5cdFx0Ly8gLS0tLS0tLS1BY3Rpb25zL0V2ZW50cy0tLS0tLS0tXG5cblx0XHQvLyBnbG9iRnVuYy50b2dnbGVCdXR0b25Db250ZW50KHRoaXMpO1xuXHRcdGluaXRpYXRlKHRoaXMpO1x0XHRcdFx0XG5cdFx0Ly8gY29uc29sZS50aW1lRW5kKCdjbGljayB0b2dnbGUgd29ya2luZyB0aW1lJyk7XG5cdFx0XHRcblx0fSk7XG5cblxufSkoKTsqL1xuICAvKmdsb2IuUmFkaW9PcGVuQ2xvc2VNb2R1bGUgID0gKGZ1bmN0aW9uKCkge1xuXHQvLyBjb25zb2xlLmxvZygnT3BlbkNsb3NlTW9kdWxlIG9rJyk7XG5cdC8vIGNvbnNvbGUudGltZSgnVG9nZ2xlQ29udGVudCBNb2R1bGUgbG9hZCcpO1xuXG5cdGZ1bmN0aW9uIGhpZGVHcm91cChncm91cE5hbWUsIGNvbnRyb2xDbGFzcykge1xuXHRcdHZhciBncm91cEJsb2NrcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoZ3JvdXBOYW1lKTtcblxuXHRcdGlmIChncm91cEJsb2Nrcy5sZW5ndGgpIHtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBCbG9ja3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0Z3JvdXBCbG9ja3NbaV0uY2xhc3NMaXN0LmNvbnRhaW5zKGNvbnRyb2xDbGFzcykgPyBncm91cEJsb2Nrc1tpXS5jbGFzc0xpc3QucmVtb3ZlKGNvbnRyb2xDbGFzcykgOiBudWxsO1xuXHRcdFx0fVxuXHRcdH1cblxuXHR9XG5cblx0ZnVuY3Rpb24gaW5pdGlhdGUoYnV0dG9ucykge1xuXHRcdHZhciBidXR0b24sXG5cdFx0XHRcdGJ1dHRvbkRhdGEsXG5cdFx0XHRcdHRhcmdldCxcblx0XHRcdFx0Y29udHJvbENsYXNzLFxuXHRcdFx0XHRpc0dyb3VwQ2hhbmdlLCBjdXJyZW50R3JvdXA7XG5cdFx0XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRidXR0b24gPSBidXR0b25zW2ldLFxuXHRcdFx0YnV0dG9uRGF0YSA9IGJ1dHRvbi5kYXRhc2V0LFxuXHRcdFx0dGFyZ2V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYnV0dG9uRGF0YS50YXJnZXQpLFxuXHRcdFx0Y29udHJvbENsYXNzID0gYnV0dG9uRGF0YS5jbGFzcztcblx0XHRcdGlzR3JvdXBDaGFuZ2UgPSBjdXJyZW50R3JvdXAgPT09IGJ1dHRvbi5uYW1lID8gZmFsc2UgOiB0cnVlO1xuXHRcdFx0Y3VycmVudEdyb3VwID0gYnV0dG9uLm5hbWU7XG5cblx0XHRcdGlmIChpc0dyb3VwQ2hhbmdlKSB7XG5cdFx0XHRcdGhpZGVHcm91cChjdXJyZW50R3JvdXAsIGNvbnRyb2xDbGFzcylcblx0XHRcdH1cblxuXHRcdFx0aWYgKGJ1dHRvbi5jaGVja2VkICYmIHRhcmdldCkge1xuXHRcdFx0XHR0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKGNvbnRyb2xDbGFzcykgPyBudWxsIDogdGFyZ2V0LmNsYXNzTGlzdC5hZGQoY29udHJvbENsYXNzKTtcblx0XHRcdH1cdFx0XHRcblx0XHR9XG5cdFxuXHR9XG5cblx0dmFyIGFsbFJhZGlvQnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3JhZGlvQnV0dG9uJyk7XG5cblx0aWYgKGFsbFJhZGlvQnV0dG9ucy5sZW5ndGgpIHsgaW5pdGlhdGUoYWxsUmFkaW9CdXR0b25zKX1cblx0Ly8gLS0tLVNob3cgQ29udGVudCBBY3Rpb25zIC0tLS0tLS0tLVxuXHQkKCdib2R5Jykub24oJ2NsaWNrJywgJy5yYWRpb0J1dHRvbicsIGZ1bmN0aW9uKCkge1xuXHRcdC8vIGNvbnNvbGUudGltZSgnY2xpY2sgdG9nZ2xlIHdvcmtpbmcgdGltZScpO1xuXG5cdFx0Ly8gLS0tLS0tLS1BY3Rpb25zL0V2ZW50cy0tLS0tLS0tXG5cdFx0dmFyIGJ1dHRvbiA9IFtdO1xuXHRcdGJ1dHRvbi5wdXNoKHRoaXMpXG5cdFx0Ly8gZ2xvYkZ1bmMudG9nZ2xlQnV0dG9uQ29udGVudCh0aGlzKTtcblx0XHRpbml0aWF0ZShidXR0b24pO1x0XHRcdFx0XG5cdFx0Ly8gY29uc29sZS50aW1lRW5kKCdjbGljayB0b2dnbGUgd29ya2luZyB0aW1lJyk7XG5cdFx0XHRcblx0fSk7XG5cblxufSkoKTsqL1xuIFxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdGdsb2IubmF2TWVudVdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmF2TWVudVdyYXBwZXInKTtcblx0Z2xvYi5uYXZNZW51ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hdk1lbnUnKTtcblx0Z2xvYi5wYWdlT3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlT3ZlcmxheScpO1xuXG5cdGlmICghJCgnYm9keScpKSB7Y29uc29sZS5sb2coJ2pRdWVyeSBFcnJvcicpfVxuXHQvLyBjb25zb2xlLmxvZyh0ZXN0KTtcblxuXHQvKiQoJy5tYWluSGVhZGVyJykub24oJ2NsaWNrJywgJy5tZW51LWJ1dHRvbicsIGZ1bmN0aW9uKGUpIHtcblx0XHRnbG9iRnVuYy50b2dnbGVCdXR0b25Db250ZW50KHRoaXMpXHRcblx0fSlcblxuXHQkKCcubWFpbkhlYWRlcicpLm9uKCdibHVyJywgJy5tZW51LWJ1dHRvbicsIGZ1bmN0aW9uKCkge1xuXHRcdC8vIGNvbnNvbGUubG9nKCdibHVyJylcblx0XHRpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XG5cdFx0XHRnbG9iRnVuYy50b2dnbGVCdXR0b25Db250ZW50KHRoaXMpXHRcdFx0XG5cdFx0fVxuXHR9KSovXG5cblx0JCgnLmRyb3Bkb3duQnV0dG9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0Z2xvYkZ1bmMudG9nZ2xlQnV0dG9uQ29udGVudCh0aGlzKVxuXHRcdGdsb2JGdW5jLmRyb3BEb3duKHRoaXMsIGdsb2IubmF2TWVudVdyYXBwZXIpXG5cdH0pXG5cblxuICAvLyAtLS0tLS0tLS1Qb3B1cHMgQmxvY2stLS0tLS0tXG5cblx0JCgnYm9keScpLm9uKCdjbGljaycsICcuc2VhcmNoQnV0dG9uJywgZnVuY3Rpb24oKSB7XG4gIFx0Ly8gZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBcdGxldCBtb2RhbCA9ICQoJyNwb3B1cFNlYXJjaCcpO1xuICBcdGlmICggbW9kYWwubGVuZ3RoICkge1xuICBcdFx0Z2xvYi5Qb3B1cE1vZHVsZS5vcGVuUG9wdXAobW9kYWwsIFwianNfb3BlblBvcHVwX3NlYXJjaFwiKTtcbiAgXHR9XG4gIH0pO1xuXG4gICQoJ2JvZHknKS5vbignY2xpY2snLCAnLmJ1dHRvbicsIGZ1bmN0aW9uKCkge1xuICBcdC8vIGUucHJldmVudERlZmF1bHQoKTtcbiAgXHRsZXQgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWQnKTtcbiAgXHRpZiAoIG1vZGFsICkge1xuICBcdFx0Z2xvYi5Qb3B1cE1vZHVsZS5vcGVuUG9wdXAobW9kYWwpO1xuICBcdH1cbiAgfSk7XG5cbiAgLy8gLS0tLS0tLS0tQWNjb3JkaW9uIEJsb2Nrcy0tLS0tLS1cblx0LyokKCdhY2NvcmRpb25CbG9ja1NlbGVjdG9yJykub24oJ2NsaWNrJywgJy5idXR0b25TZWxlY3RvcicsIGZ1bmN0aW9uKGUpIHtcblx0XHQvLyBjb25zb2xlLnRpbWUoJ2NsaWNrIGFjY29yZGlvbiB3b3JraW5nIHRpbWUnKTtcblxuXHRcdGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPCA5OTIpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRsZXQgc3VibWVudUJsb2NrO1xuXHRcdFx0bGV0IGJ1dHRvbiA9IHRoaXM7XG5cblx0XHRcdHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaWRlYmFyT3BlbkJ1dHRvbicpID8gXG5cdFx0XHRcdHN1Ym1lbnVCbG9jayA9IHRoaXMucGFyZW50RWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcgOiBcblx0XHRcdFx0c3VibWVudUJsb2NrID0gdGhpcy5uZXh0RWxlbWVudFNpYmxpbmc7XG5cblx0XHQvLyBsZXQgc2libGluZ3NCbG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjcHVibGljSW5mb1BhZ2UgYXJ0aWNsZS5wdWJsaWNJbmZvLWJsb2NrIC50aXRsZUJsb2NrICsgLmhpZGRlbkNvbnRlbnQnKTtcblxuXHRcdFx0Z2xvYkZ1bmMudG9nZ2xlQnV0dG9uQ29udGVudChidXR0b24pO1xuXHRcdFx0Z2xvYi5BY2NvcmRpb25Nb2R1bGUudG9nZ2xlQ29udGVudChcIndpdGhvdXRTaWJsaW5nc1wiLCBidXR0b24sIHN1Ym1lbnVCbG9jayApO1xuXHRcdFx0Ly8gQWNjb3JkaW9uTW9kdWxlLnRvZ2dsZUNvbnRlbnQoXCJ3aXRoU2libGluZ3NcIiwgYnV0dG9uLCBzdWJtZW51QmxvY2ssIHNpYmxpbmdzQmxvY2tzICk7XHRcdFx0XHRcblxuXHRcdH1cblx0XHQvLyBjb25zb2xlLnRpbWVFbmQoJ2NsaWNrIGFjY29yZGlvbiB3b3JraW5nIHRpbWUnKTtcblx0fSkqL1xuXG4gIC8vIC0tLS0tLS0tLVRleHQgTGltaXQtLS0tLS0tXG5cdC8qbGV0IHRleHRCbG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VsZWN0b3InKTtcblx0dGV4dEJsb2Nrcy5sZW5ndGggPyBUZXh0TGltaXRNb2R1bGUuc2xpY2VUZXh0KHRleHRCbG9ja3MsIDE4MCkgOiBudWxsOyovXG5cdCQoXCIuZGVzY3JpcHRpb24gLmVsbGlwc2lzXCIpLmRvdGRvdGRvdCh7XHRoZWlnaHQ6IDgwLFx0dHJ1bmNhdGU6IFwid29yZFwiLFx0d2F0Y2g6IHRydWV9KTtcblx0JChcIi50aXRsZS5lbGxpcHNpc1wiKS5kb3Rkb3Rkb3Qoe1x0aGVpZ2h0OiA4NSxcdHRydW5jYXRlOiBcIndvcmRcIixcdHdhdGNoOiB0cnVlfSk7XG5cdFxuXG5cdC8vIC0tLS0tLS0tLS1TY3JvbGwtdG8gU2VjdGlvbi0tLS0tLS0tLS0tLS0tLVxuXHRcblx0Ly8gJCgnYm9keScpLm9uKCdjbGljaycsICdhcnRpY2xlLnN0b3J5LWl0ZW0nLCBmdW5jdGlvbigpIHtcblx0XHRcblx0Ly8gXHQkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG5cdC8vIFx0XHRzY3JvbGxUb3A6ICQoXCIjXCIgKyAkKHRoaXMpLmF0dHIoJ2RhdGEtc3RvcnktaWQnKSApLm9mZnNldCgpLnRvcFxuXHQvLyBcdH0sIDUwMCk7XG5cdC8vIH0pXG5cblx0Ly8gLS0tLS0tLS0tLSBTdGlja3kgYmxvY2stLS0tLS0tLS0tLS0tLS1cblx0Lyp2YXIgc3RpY2t5QXNpZGVCbG9jayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2FzaWRlLnN0aWNreScpO1xuXG5cdGlmICggc3RpY2t5QXNpZGVCbG9jayAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggPiA5OTEgKSB7XG5cdFx0dmFyIHRhcmdldFN0aWNrQmxvY2sgPSBzdGlja3lBc2lkZUJsb2NrLmZpcnN0RWxlbWVudENoaWxkO1xuXHRcdGxldCByZWxhdGl2ZUJsb2NrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3RpY2t5QXNpZGVCbG9jay5kYXRhc2V0LnN0aWNrVG8pXG5cblx0XHRnbG9iLlN0aWNreUJsb2NrTW9kdWxlLnRvU3RpY2sodGFyZ2V0U3RpY2tCbG9jaywgcmVsYXRpdmVCbG9jayk7XHRcdFxuXHR9Ki9cblxuXHQvLyAtLS0tLS0tLS1DbGVhbiBlbXB0eSBUYWdzLS0tLS1cblx0dmFyIHRleHRCbG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVzY3JpcHRpb24gPiBwJyk7XG5cblx0aWYgKHRleHRCbG9ja3MubGVuZ3RoKSB7XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0QmxvY2tzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR0ZXh0QmxvY2tzW2ldLmlubmVySFRNTCA/IG51bGwgOiB0ZXh0QmxvY2tzW2ldLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGV4dEJsb2Nrc1tpXSk7XG5cdFx0fVxuXHR9XG5cblx0Ly8gLS0tLS0tLVNlbGVjdC0tLS0tLS0tLS1cblx0LyokKFwiLmNob3Nlbi13cmFwcGVyIHNlbGVjdFwiKS5jaG9zZW4oe1xuXHQgIGRpc2FibGVfc2VhcmNoX3RocmVzaG9sZDogOCxcblx0ICBub19yZXN1bHRzX3RleHQ6IFwi0J3QuNGH0LXQs9C+INC90LUg0L3QsNC50LTQtdC90L4hXCIsXG5cdCAgd2lkdGg6IFwiMTAwJVwiXG5cdH0pOyovXG5cblxuXG5cdFxuXHRcblx0XG5cdC8vID09PT09PT09PT09SW5pdGlhbGl6YXRpb25zPT09PT09PT09PT09PVxuXHRcblxuXHR2YXIgdyA9IHdpbmRvdy5pbm5lcldpZHRoXG5cdHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aFxuXHR8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoO1xuXHRpZiAoIHcgPCA0NTAgKXtcblx0ICAkKCcuc2xpZGVJdGVtJykuc2xpY2soe1xuXHRcdCAgc2xpZGVzVG9TaG93OiAxLFxuXHRcdCAgc2xpZGVzVG9TY3JvbGw6IDEsXG5cdFx0ICBhcnJvd3M6IGZhbHNlLFxuXHRcdCAgZmFkZTogdHJ1ZSxcblx0XHQgIGFzTmF2Rm9yOiAnLnNsaWRlSXRlbVZlcnRpY2FsJ1xuXHRcdH0pO1xuXHRcdCQoJy5zbGlkZUl0ZW1WZXJ0aWNhbCcpLnNsaWNrKHtcblx0XHQgIHNsaWRlc1RvU2hvdzogMSxcblx0XHQgIHNsaWRlc1RvU2Nyb2xsOiAxLFxuXHRcdCAgYXNOYXZGb3I6ICcuc2xpZGVJdGVtJyxcblx0XHQgIGRvdHM6IHRydWUsXG5cdFx0ICBjZW50ZXJNb2RlOiB0cnVlLFxuXHRcdCAgZm9jdXNPblNlbGVjdDogdHJ1ZSxcblx0XHQgIHZlcnRpY2FsOiB0cnVlLFxuXHRcdH0pO1xuXHR9XG5cdFxuXHRcblx0dmFyIHcgPSB3aW5kb3cuaW5uZXJXaWR0aFxuXHR8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGhcblx0fHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDtcblx0aWYgKCB3ID4gNTUwICl7XG5cdCQoJy5zbGlkZUl0ZW0nKS5zbGljayh7XG5cdFx0c2xpZGVzVG9TaG93OiAxLFxuXHRcdHNsaWRlc1RvU2Nyb2xsOiAxLFxuXHRcdGFycm93czogZmFsc2UsXG5cdFx0ZmFkZTogdHJ1ZSxcblx0XHRhc05hdkZvcjogJy5zbGlkZUl0ZW1WZXJ0aWNhbCdcblx0ICB9KTtcblx0ICAkKCcuc2xpZGVJdGVtVmVydGljYWwnKS5zbGljayh7XG5cdFx0c2xpZGVzVG9TaG93OiAzLFxuXHRcdHNsaWRlc1RvU2Nyb2xsOiAxLFxuXHRcdGFzTmF2Rm9yOiAnLnNsaWRlSXRlbScsXG5cdFx0ZG90czogdHJ1ZSxcblx0XHRjZW50ZXJNb2RlOiB0cnVlLFxuXHRcdGZvY3VzT25TZWxlY3Q6IHRydWUsXG5cdFx0dmVydGljYWw6IHRydWUsXG5cdCAgfSk7XG5cdH1cblxuXHQgIHZhciB3ID0gd2luZG93LmlubmVyV2lkdGhcblx0ICB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGhcblx0ICB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoO1xuXHQgIGlmICggdyA8IDU1MCApe1xuXHRcdCQoJy5zbGlkZUl0ZW0nKS5zbGljayh7XG5cdFx0XHRzbGlkZXNUb1Nob3c6IDEsXG5cdFx0XHRzbGlkZXNUb1Njcm9sbDogMSxcblx0XHRcdGFycm93czogZmFsc2UsXG5cdFx0XHRmYWRlOiB0cnVlLFxuXHRcdFx0YXNOYXZGb3I6ICcuc2xpZGVJdGVtVmVydGljYWwnXG5cdFx0ICB9KTtcblx0XHQgICQoJy5zbGlkZUl0ZW1WZXJ0aWNhbCcpLnNsaWNrKHtcblx0XHRcdHNsaWRlc1RvU2hvdzogMixcblx0XHRcdHNsaWRlc1RvU2Nyb2xsOiAxLFxuXHRcdFx0YXNOYXZGb3I6ICcuc2xpZGVJdGVtJyxcblx0XHRcdGRvdHM6IHRydWUsXG5cdFx0XHRjZW50ZXJNb2RlOiB0cnVlLFxuXHRcdFx0Zm9jdXNPblNlbGVjdDogdHJ1ZSxcblx0XHRcdHZlcnRpY2FsOiB0cnVlLFxuXHRcdCAgfSk7XG5cdCAgfVxuXG5cdFxuXG5cblxuXHR2YXIgdyA9IHdpbmRvdy5pbm5lcldpZHRoXG5cdHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aFxuXHR8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoO1xuXHRpZiAoIHcgPCA3NjggKXtcblx0XHQkKCcuc2xpZGVzaG93Jykuc2xpY2soeyBcblx0XHRcdGRvdHM6IHRydWUsXG5cdFx0XHRpbmZpbml0ZTogdHJ1ZSxcblx0XHRcdHNwZWVkOiA1MDAsXG5cdFx0XHRmYWRlOiB0cnVlLFxuXHRcdFx0Y3NzRWFzZTogJ2xpbmVhcidcblx0XHR9KTtcblxuXG5cblx0XHQkKCcuc2xpZGUnKS5zbGljayh7IFxuXHRcdFx0ZG90czogdHJ1ZSxcblx0XHRcdGluZmluaXRlOiBmYWxzZSxcblx0XHRcdHNwZWVkOiA1MDAsXG5cdFx0XHRzbGlkZXNUb1Nob3c6IDQsXG5cdFx0XHRzbGlkZXNUb1Njcm9sbDogNCxcblx0XHRcdHJlc3BvbnNpdmU6IFtcblx0XHRcdCAge1xuXHRcdFx0XHRicmVha3BvaW50OiAxMDI0LFxuXHRcdFx0XHRzZXR0aW5nczoge1xuXHRcdFx0XHQgIHNsaWRlc1RvU2hvdzogMyxcblx0XHRcdFx0ICBzbGlkZXNUb1Njcm9sbDogMyxcblx0XHRcdFx0ICBpbmZpbml0ZTogdHJ1ZSxcblx0XHRcdFx0ICBkb3RzOiB0cnVlXG5cdFx0XHRcdH1cblx0XHRcdCAgfSxcblx0XHRcdCAge1xuXHRcdFx0XHRicmVha3BvaW50OiA2MDAsXG5cdFx0XHRcdHNldHRpbmdzOiB7XG5cdFx0XHRcdCAgc2xpZGVzVG9TaG93OiAyLFxuXHRcdFx0XHQgIHNsaWRlc1RvU2Nyb2xsOiAyXG5cdFx0XHRcdH1cblx0XHRcdCAgfSxcblx0XHRcdCAge1xuXHRcdFx0XHRicmVha3BvaW50OiA0ODAsXG5cdFx0XHRcdHNldHRpbmdzOiB7XG5cdFx0XHRcdCAgc2xpZGVzVG9TaG93OiAxLFxuXHRcdFx0XHQgIHNsaWRlc1RvU2Nyb2xsOiAxXG5cdFx0XHRcdH1cblx0XHRcdCAgfVxuXHRcdFx0XVxuXHRcdH0pO1xuXHR9XG5cdFxuXG5cbn0pO1xuXG5cbnZhciBjb250YWluZXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250YWluZXInKTtcbnZhciBtaXhlciA9IG1peGl0dXAoY29udGFpbmVyRWwpO1xuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG5cdGNvbnNvbGUubG9nKCd3aW5kb3cgbG9hZCcpXG5cdC8vICQoJyNwYWdlLXByZWxvYWRlcicpLmZhZGVPdXQoJ3Nsb3cnKTtcblxuXHQvLyBnbG9iLkxhenlMb2FkTW9kdWxlLmluaXRMYXp5KCdsYXp5QmxvY2snKVxufVxuXG5cbiJdfQ==
